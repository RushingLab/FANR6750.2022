<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 14: Generalized linear models • FANR6750</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 14: Generalized linear models">
<meta property="og:description" content="FANR6750">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FANR6750</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2022.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a>
    </li>
    <li>
      <a href="../articles/lectures/01_basic_stats/01_basic_stats.html">Lecture 1: Basic concepts in statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/02_estimation/02_estimation.html">Lecture 2: Principles of Estimation</a>
    </li>
    <li>
      <a href="../articles/lectures/03_models/03_models.html">Lecture 3: Introduction to Statistical Modeling</a>
    </li>
    <li>
      <a href="../articles/lectures/04_NHST/04_NHST.html">Lecture 4: t-tests and Null Hypothesis Testing</a>
    </li>
    <li>
      <a href="../articles/lectures/05_anova/05_anova.html">Lecture 5: One-way ANOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/06_mult_comparisons/06_mult_comparisons.html">Lecture 6: Multiple Comparisons</a>
    </li>
    <li>
      <a href="../articles/lectures/07_contrasts/07_contrasts.html">Lecture 7: Contrasts</a>
    </li>
    <li>
      <a href="../articles/lectures/08_power-analysis/08_power-analysis.html">Lecture 8: Power Analysis</a>
    </li>
    <li>
      <a href="../articles/lectures/09_assumptions/09_assumptions.html">Lecture 9: Assumptions and transformations</a>
    </li>
    <li>
      <a href="../articles/lectures/10_estimation/10_estimation.html">Lecture 10: Confidence intervals</a>
    </li>
    <li>
      <a href="../articles/lectures/11_blocking/11_blocking.html">Lecture 11: Blocking</a>
    </li>
    <li>
      <a href="../articles/lectures/12_raneff/12_raneff.html">Lecture 12: Random effects</a>
    </li>
    <li>
      <a href="../articles/lectures/13_factorial/13_factorial.html">Lecture 13: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lectures/14_nesting/14_nesting.html">Lecture 14: Nested effects</a>
    </li>
    <li>
      <a href="../articles/lectures/15_splitplot/15_splitplot.html">Lecture 15: Split-plot designs</a>
    </li>
    <li>
      <a href="../articles/lectures/16_repeated_measures/16_repeated_measures.html">Lecture 16: Repeated measures</a>
    </li>
    <li>
      <a href="../articles/lectures/17_ANCOVA/17_ANCOVA.html">Lecture 17: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/18_lm/18_lm.html">Lecture 18: Linear regression</a>
    </li>
    <li>
      <a href="../articles/lectures/19_glm/19_glm.html">Lecture 19: Generalized linear models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab01_Intro_to_R.html">Lab 1: Introduction to R</a>
    </li>
    <li>
      <a href="../articles/lab02_Intro_project_and_Rmd.html">Lab 2: Introduction to RMarkdown and Projects</a>
    </li>
    <li>
      <a href="../articles/lab03_t-tests.html">Lab 3: t-tests</a>
    </li>
    <li>
      <a href="../articles/lab04_ANOVA.html">Lab 4: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab05_contrasts.html">Lab 5: Contrasts</a>
    </li>
    <li>
      <a href="../articles/lab06_assump_nonpar.html">Lab 6: Assumptions of ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab07_blocking.html">Lab 7: Blocking</a>
    </li>
    <li>
      <a href="../articles/lab08_factorial.html">Lab 8: Factorial</a>
    </li>
    <li>
      <a href="../articles/lab09_nested.html">Lab 9: Nesting</a>
    </li>
    <li>
      <a href="../articles/lab10_splitplot.html">Lab 10: Split-plot design</a>
    </li>
    <li>
      <a href="../articles/lab11_repeated_measures.html">Lab 11: Repeated Measures</a>
    </li>
    <li>
      <a href="../articles/lab12_ANCOVA.html">Lab 12: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lab13_lm.html">Lab 13: Linear regression</a>
    </li>
    <li>
      <a href="../articles/lab14_glm.html">Lab 14: Generalized linear models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework.html">Assignment instructions</a>
    </li>
    <li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/RMarkdown.html">R Markdown reference</a>
    </li>
    <li>
      <a href="../articles/graphics.html">Creating publication-quality graphics</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 14: Generalized linear models</h1>
            <h3 data-toc-skip class="subtitle">FANR 6750: Experimental
Methods in Forestry and Natural Resources Research</h3>
                        <h4 data-toc-skip class="author">Fall 2022</h4>
            
      
      
      <div class="hidden name"><code>lab14_glm.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="logistic-regression">Logistic regression<a class="anchor" aria-label="anchor" href="#logistic-regression"></a>
</h2>
<p>Remember from lecture the logistic regression model:</p>
<p><span class="math display">\[\Large logit(p_i) = \beta_0 +
\beta_1x_{i1} + \beta_2x_{i2} + · · ·\]</span></p>
<p><span class="math display">\[\Large y_i \sim binomial(N,
p_i)\]</span> where:</p>
<ul>
<li><p><span class="math inline">\(N\)</span> is the number of ‘trials’
(e.g. coin flips)</p></li>
<li><p><span class="math inline">\(p_i\)</span> is the probability of a
success for sample unit <span class="math inline">\(i\)</span></p></li>
</ul>
<div class="section level3">
<h3 id="example-frog-data">Example: Frog data<a class="anchor" aria-label="anchor" href="#example-frog-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"frogData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">frogData</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:right;">
presence
</th>
<th style="text-align:right;">
abundance
</th>
<th style="text-align:right;">
elevation
</th>
<th style="text-align:left;">
habitat
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
191
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
374
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
337
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
</tbody>
</table>
<p>Let’s start by using the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function to model the
relationship between frog detections (0 = not detected, 1 = detected),
habitat, and elevation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">presence</span> <span class="op">~</span> <span class="va">habitat</span> <span class="op">+</span> <span class="va">elevation</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">frogData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = presence ~ habitat + elevation, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = frogData)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt; -1.884  -0.617   0.167   0.605   1.377  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)  </span></span>
<span><span class="co">#&gt; (Intercept) -0.99598    1.21698   -0.82    0.413  </span></span>
<span><span class="co">#&gt; habitatOak  -0.09678    1.36752   -0.07    0.944  </span></span>
<span><span class="co">#&gt; habitatPine -0.33722    1.38157   -0.24    0.807  </span></span>
<span><span class="co">#&gt; elevation    0.01366    0.00601    2.27    0.023 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 34.795  on 29  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 23.132  on 26  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 31.13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span></code></pre></div>
<p>Notice that we use the <code>family =</code> argument to tell
<code>R</code> that this is a logistic (i.e., binomial) glm with a logit
link function.</p>
<hr>
<p>What do the parameter estimates from this model represent, including
the intercept? What can we say about the effects of habitat and
elevation on the probability of detecting a frog?</p>
<p>Use the <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code> function to examine the dummy
variable structure and contrasts.</p>
<hr>
<p>As we have seen previously, we can use <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> to
estimate occurrence probability at different combinations of elevation
and habitat. For example, how does probability of occurrence differ
across elevations in oak habitat:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predData.elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elevation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">489</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,habitat <span class="op">=</span> <span class="st">"Oak"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">predData.elev</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:right;">
elevation
</th>
<th style="text-align:left;">
habitat
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
12.00
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
21.73
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
31.47
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
41.20
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
50.94
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
<tr>
<td style="text-align:right;">
60.67
</td>
<td style="text-align:left;">
Oak
</td>
</tr>
</tbody>
</table>
<p>By default, the predictions are on the link scale so to get
confidence intervals on the probability scale, we have to back transform
using the inverse-link (<code><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis()</a></code>):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fm1</span>, newdata <span class="op">=</span> <span class="va">predData.elev</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predData.elev</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span> <span class="co"># back transform to probability scale</span></span>
<span><span class="va">predData.elev</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">predData.elev</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span></code></pre></div>
<p>And now plot the predictions and observations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">frogData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">elevation</span>, y <span class="op">=</span> <span class="va">presence</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData.elev</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">elevation</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData.elev</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">elevation</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Probability of occurrence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Elevation (m)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab14_glm_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<p>What about occurrence probability in each habitat type:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predData.hab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Oak"</span>, <span class="st">"Maple"</span>, <span class="st">"Pine"</span><span class="op">)</span>, elevation <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="va">pred.hab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fm1</span>, newdata <span class="op">=</span> <span class="va">predData.hab</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predData.hab</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred.hab</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span> <span class="co"># back transform to probability scale</span></span>
<span><span class="va">predData.hab</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred.hab</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="va">pred.hab</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">predData.hab</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">pred.hab</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="va">pred.hab</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData.hab</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">habitat</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData.hab</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">habitat</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Probability of occurrence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span><span class="st">"Habitat type"</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab14_glm_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="poisson-regression">Poisson regression<a class="anchor" aria-label="anchor" href="#poisson-regression"></a>
</h2>
<p>Remember from lecture that the model for the Poisson regression
is:</p>
<p><span class="math display">\[\Large log(\lambda_i) = \beta_0 +
\beta_1x_{i1} + \beta_2x_{i2} + · · ·\]</span> <span class="math display">\[\Large y_i \sim Poisson(\lambda_i)\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\lambda_i\)</span> is the expected value
of <span class="math inline">\(y_i\)</span>
</li>
</ul>
<hr>
<p>In the linear regression model we saw in previous weeks, we had a
variance term <span class="math inline">\(sigma^2\)</span> that measured
on far, on average, each response was from it’s expected value. But
neither of the two generalized linear models we learned about here have
an equivalent variance term. Why is that?</p>
<hr>
<p>Using the frog data, let’s model the number of frogs detected at each
point as a function of habitat and elevation:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">abundance</span> <span class="op">~</span> <span class="va">habitat</span> <span class="op">+</span> <span class="va">elevation</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">frogData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = abundance ~ habitat + elevation, family = poisson(link = "log"), </span></span>
<span><span class="co">#&gt;     data = frogData)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt; -2.631  -1.081  -0.107   0.335   2.793  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -0.786953   0.294117   -2.68   0.0075 ** </span></span>
<span><span class="co">#&gt; habitatOak  -0.153392   0.197101   -0.78   0.4364    </span></span>
<span><span class="co">#&gt; habitatPine -0.065281   0.110385   -0.59   0.5543    </span></span>
<span><span class="co">#&gt; elevation    0.009784   0.000629   15.55   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 700.762  on 29  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  44.891  on 26  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 140.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></span></code></pre></div>
<p>Again, be sure you can interpret the parameters in this model,
including the intercept.</p>
<p>To get confidence intervals on the <span class="math inline">\((0,
\infty)\)</span> scale, predict on the log (link) scale and then back
transform using the inverse-link (<code><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp()</a></code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fm2</span>, newdata <span class="op">=</span> <span class="va">predData.elev</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predData.elev</span><span class="op">$</span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span> <span class="co"># exp is the inverse-link function</span></span>
<span><span class="va">predData.elev</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">predData.elev</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">pred.link</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred.link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">frogData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">elevation</span>, y <span class="op">=</span> <span class="va">abundance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData.elev</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">elevation</span>, y <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData.elev</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">elevation</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Elevation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Expected abundance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab14_glm_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="assignment-not-for-a-grade">Assignment (not for a grade)<a class="anchor" aria-label="anchor" href="#assignment-not-for-a-grade"></a>
</h2>
<p>Researchers want to know how latitude and landscape type influence
the probability that American Crows are infected by West Nile Virus. One
hundred crows are captured and tested for West Nile Virus in urban and
rural landscapes spanning a latitude gradient.</p>
<p>The data can be loaded using:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"crowData"</span><span class="op">)</span></span></code></pre></div>
<p>Create an R markdown report to do the following:</p>
<ol style="list-style-type: decimal">
<li><p>Fit a logistic regression model to the crow data to assess the
effects of latitude and landscape type</p></li>
<li><p>Include a well-formatted summary table of the parameter
estimates</p></li>
<li><p>Provide a clear interpretation of the parameter estimates in the
text</p></li>
<li>
<p>Plot the relationship between infection probability and latitude,
for rural and urban landscapes, on the same graph. The graph should
include:</p>
<ul>
<li><p>the observed data points (color coded by landscape)</p></li>
<li><p>a legend</p></li>
<li><p>confidence intervals</p></li>
</ul>
</li>
</ol>
<p>You may format the report however you like but it should be
well-organized, with relevant headers, plain text, and the elements
described above.</p>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to:
<code>output: html_document</code></p></li>
<li><p>Title the document:
<code>title: "Lab 14 optional assignment"</code></p></li>
<li><p>Be sure to include your first and last name in the
<code>author</code> section</p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code>
chunks so we can see both your code and the output</p></li>
<li><p>See the R Markdown reference sheet for help with creating
<code>R</code> chunks, equations, tables, etc.</p></li>
<li><p>See the “Creating publication-quality graphics” reference sheet
for tips on formatting figures</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
