<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 11: Repeated measures • FANR6750</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 11: Repeated measures">
<meta property="og:description" content="FANR6750">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FANR6750</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2022.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a>
    </li>
    <li>
      <a href="../articles/lectures/01_basic_stats/01_basic_stats.html">Lecture 1: Basic concepts in statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/02_estimation/02_estimation.html">Lecture 2: Principles of Estimation</a>
    </li>
    <li>
      <a href="../articles/lectures/03_models/03_models.html">Lecture 3: Introduction to Statistical Modeling</a>
    </li>
    <li>
      <a href="../articles/lectures/04_NHST/04_NHST.html">Lecture 4: t-tests and Null Hypothesis Testing</a>
    </li>
    <li>
      <a href="../articles/lectures/05_anova/05_anova.html">Lecture 5: One-way ANOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/06_mult_comparisons/06_mult_comparisons.html">Lecture 6: Multiple Comparisons</a>
    </li>
    <li>
      <a href="../articles/lectures/07_contrasts/07_contrasts.html">Lecture 7: Contrasts</a>
    </li>
    <li>
      <a href="../articles/lectures/08_power-analysis/08_power-analysis.html">Lecture 8: Power Analysis</a>
    </li>
    <li>
      <a href="../articles/lectures/09_assumptions/09_assumptions.html">Lecture 9: Assumptions and transformations</a>
    </li>
    <li>
      <a href="../articles/lectures/10_estimation/10_estimation.html">Lecture 10: Confidence intervals</a>
    </li>
    <li>
      <a href="../articles/lectures/11_blocking/11_blocking.html">Lecture 11: Blocking</a>
    </li>
    <li>
      <a href="../articles/lectures/12_raneff/12_raneff.html">Lecture 12: Random effects</a>
    </li>
    <li>
      <a href="../articles/lectures/13_factorial/13_factorial.html">Lecture 13: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lectures/14_nesting/14_nesting.html">Lecture 14: Nested effects</a>
    </li>
    <li>
      <a href="../articles/lectures/15_splitplot/15_splitplot.html">Lecture 15: Split-plot designs</a>
    </li>
    <li>
      <a href="../articles/lectures/16_repeated_measures/16_repeated_measures.html">Lecture 16: Repeated measures</a>
    </li>
    <li>
      <a href="../articles/lectures/17_ANCOVA/17_ANCOVA.html">Lecture 17: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/18_lm/18_lm.html">Lecture 18: Linear regression</a>
    </li>
    <li>
      <a href="../articles/lectures/19_glm/19_glm.html">Lecture 19: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/20_model_selection/20_model_selection.html">Lecture 20: Model selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab01_Intro_to_R.html">Lab 1: Introduction to R</a>
    </li>
    <li>
      <a href="../articles/lab02_Intro_project_and_Rmd.html">Lab 2: Introduction to RMarkdown and Projects</a>
    </li>
    <li>
      <a href="../articles/lab03_t-tests.html">Lab 3: t-tests</a>
    </li>
    <li>
      <a href="../articles/lab04_ANOVA.html">Lab 4: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab05_contrasts.html">Lab 5: Contrasts</a>
    </li>
    <li>
      <a href="../articles/lab06_assump_nonpar.html">Lab 6: Assumptions of ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab07_blocking.html">Lab 7: Blocking</a>
    </li>
    <li>
      <a href="../articles/lab08_factorial.html">Lab 8: Factorial</a>
    </li>
    <li>
      <a href="../articles/lab09_nested.html">Lab 9: Nesting</a>
    </li>
    <li>
      <a href="../articles/lab10_splitplot.html">Lab 10: Split-plot design</a>
    </li>
    <li>
      <a href="../articles/lab11_repeated_measures.html">Lab 11: Repeated Measures</a>
    </li>
    <li>
      <a href="../articles/lab12_ANCOVA.html">Lab 12: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lab13_lm.html">Lab 13: Linear regression</a>
    </li>
    <li>
      <a href="../articles/lab14_glm.html">Lab 14: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/lab14_model_selection.html">Bonus: Model selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework.html">Assignment instructions</a>
    </li>
    <li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/RMarkdown.html">R Markdown reference</a>
    </li>
    <li>
      <a href="../articles/graphics.html">Creating publication-quality graphics</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 11: Repeated measures</h1>
            <h3 data-toc-skip class="subtitle">FANR 6750: Experimental
Methods in Forestry and Natural Resources Research</h3>
                        <h4 data-toc-skip class="author">Fall 2022</h4>
            
      
      
      <div class="hidden name"><code>lab11_repeated_measures.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Experiments that use “repeated measures” methods are those that have
the following design:</p>
<ul>
<li><p>We randomly assign each ‘subject’ to a treatment</p></li>
<li><p>We record the response to the treatment over time</p></li>
</ul>
<p>In these cases, we need to think about the following sources of
variation:</p>
<ul>
<li><p>Treatment</p></li>
<li><p>Time</p></li>
<li><p>Treatment-time interaction</p></li>
<li><p>Random variation among subjects</p></li>
<li><p>Random variation within subjects</p></li>
</ul>
<div class="section level3">
<h3 id="approaches">Approaches<a class="anchor" aria-label="anchor" href="#approaches"></a>
</h3>
<p>As we saw in lecture, there are several ways to analyze repeated
measures data, including:</p>
<div class="section level5">
<h5 id="univariate">Univariate<a class="anchor" aria-label="anchor" href="#univariate"></a>
</h5>
<ul>
<li><p>This is similar to a split-plot (or nested and crossed) analysis,
but with adjusted <em>p</em>-values</p></li>
<li><p>Adjustments assuming “near-sphericity”: Greenhouse-Geisser or
Huynh-Feldt methods</p></li>
<li><p>In <code>R</code>, you must do a MANOVA to obtain these adjusted
<em>p</em>-values</p></li>
</ul>
</div>
<div class="section level5">
<h5 id="manova">MANOVA<a class="anchor" aria-label="anchor" href="#manova"></a>
</h5>
<ul>
<li><p>Testing based on Wilks’ lambda or Pillai’s trace</p></li>
<li><p>No assumptions about “sphericity” are required</p></li>
<li><p>This is usually followed by a profile analysis</p></li>
</ul>
</div>
<div class="section level5">
<h5 id="mixed-effects-model-with-arma-correlation-structure">Mixed effects model with (ARMA) correlation structure<a class="anchor" aria-label="anchor" href="#mixed-effects-model-with-arma-correlation-structure"></a>
</h5>
<ul>
<li><p>This can be done using <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code></p></li>
<li><p>We might cover this later</p></li>
</ul>
<p>Let’s see how to implement these approaches in <code>R</code></p>
</div>
</div>
<div class="section level3">
<h3 id="univariate-split-plot-approach">Univariate Split-plot Approach<a class="anchor" aria-label="anchor" href="#univariate-split-plot-approach"></a>
</h3>
<p>First, the data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"plantData"</span><span class="op">)</span></span>
<span><span class="va">plantData</span><span class="op">$</span><span class="va">plant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plantData</span><span class="op">$</span><span class="va">plant</span><span class="op">)</span></span>
<span><span class="va">plantData</span><span class="op">$</span><span class="va">fertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plantData</span><span class="op">$</span><span class="va">fertilizer</span><span class="op">)</span></span>
<span><span class="va">plantData</span><span class="op">$</span><span class="va">week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plantData</span><span class="op">$</span><span class="va">week</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">plantData</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    50 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ plant     : Factor w/ 10 levels "1","2","3","4",..: 1 1 1 1 1 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ fertilizer: Factor w/ 2 levels "H","L": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ week      : Factor w/ 5 levels "1","2","3","4",..: 1 2 3 4 5 1 2 3 4 5 ...</span></span>
<span><span class="co">#&gt;  $ leaves    : int  4 5 6 8 10 3 4 6 6 9 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plantData</span>, n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt;   plant fertilizer week leaves</span></span>
<span><span class="co">#&gt; 1     1          L    1      4</span></span>
<span><span class="co">#&gt; 2     1          L    2      5</span></span>
<span><span class="co">#&gt; 3     1          L    3      6</span></span>
<span><span class="co">#&gt; 4     1          L    4      8</span></span>
<span><span class="co">#&gt; 5     1          L    5     10</span></span>
<span><span class="co">#&gt; 6     2          L    1      3</span></span>
<span><span class="co">#&gt; 7     2          L    2      4</span></span>
<span><span class="co">#&gt; 8     2          L    3      6</span></span></code></pre></div>
<p>As we can see, these data contain information on leaf growth by 10
plants subjected to different fertilizer treatments. Leaf growth on each
plant was measured weekly for 5 weeks, leading to the repeated measures
structure.</p>
<p>As always, it helps to visualize the data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plantData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">leaves</span>, </span>
<span>                      group <span class="op">=</span> <span class="va">plant</span>, </span>
<span>                      color <span class="op">=</span> <span class="va">fertilizer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span><span class="st">"Week"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Number of leaves"</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab11_repeated_measures_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Now let’s fit the univariate model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">leaves</span> <span class="op">~</span> <span class="va">fertilizer</span> <span class="op">*</span> <span class="va">week</span> <span class="op">+</span> <span class="fu">Error</span><span class="op">(</span><span class="va">plant</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">plantData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">aov1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error: plant</span></span>
<span><span class="co">#&gt;            Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer  1   16.8   16.82     2.6   0.15</span></span>
<span><span class="co">#&gt; Residuals   8   51.7    6.46               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error: Within</span></span>
<span><span class="co">#&gt;                 Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; week             4  267.4    66.9  158.22 &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; fertilizer:week  4    5.1     1.3    3.01  0.033 *  </span></span>
<span><span class="co">#&gt; Residuals       32   13.5     0.4                   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Although this output looks ok, remember that we need to adjust the
<em>p</em>-values for the time and interaction effects. In
<code>R</code>, this requires reformatting the data and running a
MANOVA</p>
<p>Specifically, we need to covert the data from the “long” format that
it is currently in (each measurement on each plant is contained in its
own row) to the “wide” format (each plant is one row, with separate
columns for each weekly measurement). There are a number of ways to
convert between long and wide formats in <code>R</code> (all of which
are, in my opinion, confusing and require looking up syntax/examples
every time) but we’ll use the <code>pivot_wider()</code> function from
the <code>tidyr</code> package<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plantData_wide</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plantData</span>, </span>
<span>                                     names_from <span class="op">=</span> <span class="va">week</span>, </span>
<span>                                     names_prefix <span class="op">=</span> <span class="st">"week"</span>,</span>
<span>                                     values_from <span class="op">=</span> <span class="va">leaves</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">plantData_wide</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   plant fertilizer week1 week2 week3 week4 week5</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1     L              4     5     6     8    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2     L              3     4     6     6     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3     L              6     7     9    10    12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 4     L              5     7     8    10    12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 5     L              5     6     7     8    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 6     H              4     6     9     9    11</span></span></code></pre></div>
<p>Now we can run the MANOVA:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manova1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/manova.html" class="external-link">manova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">week1</span>, <span class="va">week2</span>, <span class="va">week3</span>, <span class="va">week4</span>, <span class="va">week5</span><span class="op">)</span> <span class="op">~</span> <span class="va">fertilizer</span>, </span>
<span>                  data <span class="op">=</span> <span class="va">plantData_wide</span><span class="op">)</span></span></code></pre></div>
<p>And the results will contain the adjusted <em>p</em>-values:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">manova1</span>, X <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, test <span class="op">=</span> <span class="st">"Spherical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Contrasts orthogonal to</span></span>
<span><span class="co">#&gt; ~1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Greenhouse-Geisser epsilon: 0.5882</span></span>
<span><span class="co">#&gt; Huynh-Feldt epsilon:        0.8490</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Df      F num Df den Df Pr(&gt;F) G-G Pr H-F Pr</span></span>
<span><span class="co">#&gt; (Intercept)  1 158.22      4     32 0.0000 0.0000 0.0000</span></span>
<span><span class="co">#&gt; fertilizer   1   3.01      4     32 0.0326 0.0666 0.0422</span></span>
<span><span class="co">#&gt; Residuals    8</span></span></code></pre></div>
<div class="section level4">
<h4 id="an-aside-sphericity">An aside – sphericity<a class="anchor" aria-label="anchor" href="#an-aside-sphericity"></a>
</h4>
<p><em>Sphericity</em> is the multivariate analogue of the homogeneity
of variance assumption of ANOVA.</p>
<p>Technically, adjusted <em>p</em>-values and MANOVA aren’t necessary
if the assumption of sphericity holds. However, Mauchly’s sphericity
test has low power, and it is often recommended that the
<em>p</em>-values be adjusted even if the test fails to reject the
sphericity assumption.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/mauchly.test.html" class="external-link">mauchly.test</a></span><span class="op">(</span><span class="va">manova1</span>, X<span class="op">=</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Mauchly's test of sphericity</span></span>
<span><span class="co">#&gt;  Contrasts orthogonal to</span></span>
<span><span class="co">#&gt;  ~1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  SSD matrix from manova(cbind(week1, week2, week3, week4, week5) ~ fertilizer,  SSD matrix from     data = plantData_wide)</span></span>
<span><span class="co">#&gt; W = 0.099, p-value = 0.1</span></span></code></pre></div>
<p>In this case, we fail to reject the null hypothesis, so sphericity
can be assumed, but the adjusted <em>p</em>-values should be reported
anyway.</p>
<hr>
<p>On your own, go back and compare the results from <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code>
without adjusting the <em>p</em>-values to the <code><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova()</a></code>
results from the MANOVA model. How did they change? Did our decision
about the effects of fertilizer on leaf growth change?</p>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="multivariate-tests-wilks-lambda-lambda">Multivariate tests – Wilks’ lambda (<span class="math inline">\(\Lambda\)</span>)<a class="anchor" aria-label="anchor" href="#multivariate-tests-wilks-lambda-lambda"></a>
</h3>
<p>An alternative to the adjusted <em>p</em>-value approach is to do a
multivariate analysis relaxing the assumptions about the structure of
the variance-covariance matrix.</p>
<p>The good news is we’re already most of the way there:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">manova1</span>, X<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, test<span class="op">=</span><span class="st">"Wilks"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Contrasts orthogonal to</span></span>
<span><span class="co">#&gt; ~1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Df  Wilks approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; (Intercept)  1 0.0085    146.0      4      5 2.3e-05 ***</span></span>
<span><span class="co">#&gt; fertilizer   1 0.1448      7.4      4      5   0.025 *  </span></span>
<span><span class="co">#&gt; Residuals    8                                          </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<hr>
<p>How do our conclusions from this approach compare to conclusions from
the uni-variate approach?</p>
<hr>
<p>Pillai’s trace is an alternative to Wilks’ lambda. In this case, it
returns the same <em>p</em>-values as Wilks’ test:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">manova1</span>, X<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, test<span class="op">=</span><span class="st">"Pillai"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Contrasts orthogonal to</span></span>
<span><span class="co">#&gt; ~1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             Df Pillai approx F num Df den Df  Pr(&gt;F)    </span></span>
<span><span class="co">#&gt; (Intercept)  1  0.992    146.0      4      5 2.3e-05 ***</span></span>
<span><span class="co">#&gt; fertilizer   1  0.855      7.4      4      5   0.025 *  </span></span>
<span><span class="co">#&gt; Residuals    8                                          </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<div class="section level4">
<h4 id="profile-analysis-when-do-growth-rates-differ">Profile analysis – when do growth rates differ?<a class="anchor" aria-label="anchor" href="#profile-analysis-when-do-growth-rates-differ"></a>
</h4>
<p>Profile analysis requires calculating the differences (i.e., the
number of leaves grown each week):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">manova2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/manova.html" class="external-link">manova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">week2</span> <span class="op">-</span> <span class="va">week1</span>, <span class="va">week3</span> <span class="op">-</span> <span class="va">week2</span>, <span class="va">week4</span> <span class="op">-</span> <span class="va">week3</span>, <span class="va">week5</span> <span class="op">-</span> <span class="va">week4</span><span class="op">)</span> <span class="op">~</span> <span class="va">fertilizer</span>, data <span class="op">=</span> <span class="va">plantData_wide</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/summary.aov.html" class="external-link">summary.aov</a></span><span class="op">(</span><span class="va">manova2</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Response 1 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)   </span></span>
<span><span class="co">#&gt; fertilizer   1    2.5     2.5    12.5 0.0077 **</span></span>
<span><span class="co">#&gt; Residuals    8    1.6     0.2                  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response 2 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer   1    1.6     1.6     3.2   0.11</span></span>
<span><span class="co">#&gt; Residuals    8    4.0     0.5               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response 3 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer   1    0.1     0.1    0.06   0.81</span></span>
<span><span class="co">#&gt; Residuals    8   12.8     1.6               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Response 4 :</span></span>
<span><span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span></span>
<span><span class="co">#&gt; fertilizer   1    0.1     0.1    0.09   0.77</span></span>
<span><span class="co">#&gt; Residuals    8    8.8     1.1</span></span></code></pre></div>
<p>We can also plot the growth rates. First, calculate mean growth rate
for each time interval:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leavesMat</span> <span class="op">&lt;-</span> <span class="va">plantData_wide</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="va">growthMat</span> <span class="op">&lt;-</span> <span class="va">leavesMat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">-</span> <span class="va">leavesMat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">growthMat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"interval"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, sep<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">lowFertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">growthMat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; interval.1 interval.2 interval.3 interval.4 </span></span>
<span><span class="co">#&gt;        1.2        1.4        1.2        2.2</span></span>
<span></span>
<span><span class="op">(</span><span class="va">highFertilizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">growthMat</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; interval.1 interval.2 interval.3 interval.4 </span></span>
<span><span class="co">#&gt;        2.2        2.2        1.0        2.0</span></span></code></pre></div>
<p>Next, calculate the standard errors for these growth rates:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">:::</span><span class="fu">vcov.mlm</span><span class="op">(</span><span class="va">manova2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="va">SE</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">SE</span><span class="op">)</span><span class="op">==</span><span class="st">":(Intercept)"</span><span class="op">]</span> <span class="co"># Only use "intercept" SEs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">SE</span><span class="op">)</span> <span class="co">## Ignore the names</span></span>
<span><span class="co">#&gt; [1] 0.2000 0.3162 0.5657 0.4690</span></span></code></pre></div>
<p>Now, create a data frame and plot the results:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growthDF</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                        fertilizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"High"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                        growth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lowFertilizer</span>, <span class="va">highFertilizer</span><span class="op">)</span>, </span>
<span>                        SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">SE</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">growthDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">interval</span>, y <span class="op">=</span> <span class="va">growth</span>, color <span class="op">=</span> <span class="va">fertilizer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">growth</span> <span class="op">-</span> <span class="va">SE</span>, ymax <span class="op">=</span> <span class="va">growth</span> <span class="op">+</span> <span class="va">SE</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Time interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Growth rate (leaves/week)"</span>, limits  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab11_repeated_measures_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="assignment">Assignment<a class="anchor" aria-label="anchor" href="#assignment"></a>
</h2>
<p>A researcher wants to assess the effects of crowding on the growth of
the dark toadfish (<em>Neophrynichthys latus</em>). Fifteen fish tanks
are stocked with three densities of toadfish. Five tanks have low
density (1 fish), 5 tanks have medium density (5 fish), and 5 tanks have
high density (10 fish). In each tank, the weight of one “focal fish” is
recorded on 6 consecutive weeks. The data can be loaded using:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fishData"</span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Conduct the univariate repeated measures ANOVA using
<code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code>. Calculate the adjusted <em>p</em>-values using the
Huynh-Feldt method. Does the effect of density on growth change over
time?</p></li>
<li><p>Conduct a multivariate repeated measures ANOVA and use Wilks’
lambda to test if the effect of density changes over time. What is your
conclusion?</p></li>
<li><p>Conduct a profile analysis. In which time intervals is the effect
of density on growth rate significant?</p></li>
</ol>
<p>Put your answers in an R Markdown report. Your report should
include:</p>
<ol style="list-style-type: decimal">
<li><p>Well-formatted ANOVA tables (with captions); and</p></li>
<li><p>Publication-quality plots displaying the relationships being test
and/or estimated effects. The figures should also have descriptive
captions and any aesthetics (color, line type, etc.) should be clearly
defined.</p></li>
</ol>
<p>You may format the report however you like but it should be
well-organized, with relevant headers, plain text, and the elements
described above.</p>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to:
<code>output: html_document</code></p></li>
<li><p>Title the document:
<code>title: "Homework 4: Repeated Measures"</code></p></li>
<li><p>Be sure to include your first and last name in the
<code>author</code> section</p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code>
chunks so we can see both your code and the output</p></li>
<li><p>Please upload both the <code>html</code> and <code>.Rmd</code>
files when you submit your assignment</p></li>
<li><p>See the R Markdown reference sheet for help with creating
<code>R</code> chunks, equations, tables, etc.</p></li>
<li><p>See the “Creating publication-quality graphics” reference sheet
for tips on formatting figures</p></li>
</ul>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>to run this function, we need to specify which column in
the original data frame contains the column names
(<code>names_from</code>) and which column contains the values that will
go in the new columns (<code>values_from</code>). We can also
(optionally) specify a prefix to add to each column name so that, as
would the base here, we don’t end up with numeric column names. For more
help, see <code>?pivot_wider</code><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
