<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 11: Analysis of Covariance (ANCOVA) • FANR6750</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 11: Analysis of Covariance (ANCOVA)">
<meta property="og:description" content="FANR6750">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FANR6750</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2021.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/01_basic_stats/01_basic_stats.html">Lecture 1: Basic concepts in statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/02_t-tests/02_t-tests.html">Lecture 2: t-tests</a>
    </li>
    <li>
      <a href="../articles/lectures/03_anova/03_anova.html">Lecture 3: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/04_mult_comparisons/04_mult_comparisons.html">Lecture 4: Multiple comparisons</a>
    </li>
    <li>
      <a href="../articles/lectures/05_contrasts/05_contrasts.html">Lecture 5: Contrasts</a>
    </li>
    <li>
      <a href="../articles/lectures/06_power-analysis/06_power-analysis.html">Lecture 6: Power analysis</a>
    </li>
    <li>
      <a href="../articles/lectures/07_estimation/07_estimation.html">Lecture 7: Estimation</a>
    </li>
    <li>
      <a href="../articles/lectures/08_assumptions/08_assumptions.html">Lecture 8: ANOVA assumptions</a>
    </li>
    <li>
      <a href="../articles/lectures/09_nonparametrics/09_nonparametrics.html">Lecture 9: Non-parametric statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/10_blocking/10_blocking.html">Lecture 10: Blocking</a>
    </li>
    <li>
      <a href="../articles/lectures/11_raneff/11_raneff.html">Lecture 11: Random effects</a>
    </li>
    <li>
      <a href="../articles/lectures/12_factorial/12_factorial.html">Lecture 12: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lectures/13_nesting/13_nesting.html">Lecture 13: Nested designs</a>
    </li>
    <li>
      <a href="../articles/lectures/14_splitplot/14_splitplot.html">Lecture 14: Split plot designs</a>
    </li>
    <li>
      <a href="../articles/lectures/15_repeated_measures/15_repeated_measures.html">Lecture 15: Repeated measures</a>
    </li>
    <li>
      <a href="../articles/lectures/16_ANCOVA/16_ANCOVA.html">Lecture 16: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/17_lm/17_lm.html">Lecture 17: Linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/18_glm/18_glm.html">Lecture 18: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/19_model_selection/19_model_selection.html">Lecture 19: Model selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab01_Intro_to_R.html">Lab 1: Introduction to R</a>
    </li>
    <li>
      <a href="../articles/lab02_t-tests.html">Lab 2: t-tests</a>
    </li>
    <li>
      <a href="../articles/lab03_ANOVA.html">Lab 3: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab04_contrasts.html">Lab 4: Contrasts, estimation, and power analysis</a>
    </li>
    <li>
      <a href="../articles/lab05_assump_nonpar.html">Lab 5: Assumptions of ANOVA, tranformations, and non-parametric tests</a>
    </li>
    <li>
      <a href="../articles/lab06_blocking.html">Lab 6: Randomized Complete Block Design</a>
    </li>
    <li>
      <a href="../articles/lab07_factorial.html">Lab 7: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lab08_nested.html">Lab 8: Nested ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab09_splitplot.html">Lab 9: Split plot designs</a>
    </li>
    <li>
      <a href="../articles/lab10_repeated_measures.html">Lab 10: Repeated measures</a>
    </li>
    <li>
      <a href="../articles/lab11_ANCOVA.html">Lab 11: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lab12_lm.html">Lab 12: Linear models</a>
    </li>
    <li>
      <a href="../articles/lab13_glm.html">Lab 13: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/lab14_model_selection.html">Lab 14: Model selection and multi-model inference</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework.html">Assignment instructions</a>
    </li>
    <li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/RMarkdown.html">R Markdown reference</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lab11_ANCOVA_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 11: Analysis of Covariance (ANCOVA)</h1>
            <h3 class="subtitle">FANR 6750: Experimental Methods in Forestry and Natural Resources Research</h3>
                        <h4 class="author">Fall 2021</h4>
            
      
      
      <div class="hidden name"><code>lab11_ANCOVA.Rmd</code></div>

    </div>

    
    
<div id="scenario" class="section level1">
<h1 class="hasAnchor">
<a href="#scenario" class="anchor"></a>Scenario</h1>
<p>Very commonly, we are interested in doing a one-way ANOVA but we need to account for the effect of a continuous predictor variable. How do we include the continuous predictor in the ANOVA model? Analysis of covariance (ANOVA).</p>
<p>ANCOVA can be thought of as a hybrid between ANOVA and regression. Actually, it’s more accurate to say that ANOVA, regression, and ANCOVA are all linear models. And understanding how these models are the same, and how they differ, is critical to the application of modern statistical methods.</p>
<div id="example-the-diet-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-the-diet-data" class="anchor"></a>Example: the Diet Data</h2>
<p>Load the data and check structure:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"dietData"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">dietData</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    60 obs. of  3 variables:</span>
<span class="co">#&gt;  $ weight: num  23.8 26 30.3 25.9 18.5 ...</span>
<span class="co">#&gt;  $ diet  : chr  "Control" "Control" "Control" "Control" ...</span>
<span class="co">#&gt;  $ length: num  11.62 13.56 15.36 7.95 5.49 ...</span></code></pre></div>
<p>We need to change diet to a factor, and while doing so we’ll explicitly define the level order:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dietData</span><span class="op">$</span><span class="va">diet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dietData</span><span class="op">$</span><span class="va">diet</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Low"</span>, <span class="st">"Med"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">dietData</span><span class="op">$</span><span class="va">diet</span><span class="op">)</span>
<span class="co">#&gt; [1] "Control" "Low"     "Med"     "High"</span></code></pre></div>
<p>Let’s also visualize the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dietData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="lab11_ANCOVA_files/figure-html/unnamed-chunk-3-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dietData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diet</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="lab11_ANCOVA_files/figure-html/unnamed-chunk-3-2.png" width="384" style="display: block; margin: auto;"></p>
<p>And finally, let’s quantify the relationship between length and weight using a linear regression:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">length</span>, <span class="va">dietData</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm1</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Term
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
SE
</th>
<th style="text-align:right;">
Statistic
</th>
<th style="text-align:right;">
p-value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
21.3252
</td>
<td style="text-align:right;">
0.8069
</td>
<td style="text-align:right;">
26.430
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
length
</td>
<td style="text-align:right;">
0.5181
</td>
<td style="text-align:right;">
0.0674
</td>
<td style="text-align:right;">
7.685
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>We can also add regression lines and CIs to our plot using the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function:</p>
<ol style="list-style-type: decimal">
<li><p>Create a new data frame containing a sequence of values of the predictor variable length</p></li>
<li><p>Predict weight using these values of length</p></li>
<li><p>Put predictions and data together for easy plotting</p></li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengths</span> <span class="op">&lt;-</span> <span class="va">dietData</span><span class="op">$</span><span class="va">length</span>
<span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span>
<span class="va">E1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fm1</span>, newdata <span class="op">=</span> <span class="va">nd</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span>, interval<span class="op">=</span><span class="st">"confidence"</span><span class="op">)</span>
<span class="va">predictionData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">E1</span><span class="op">$</span><span class="va">fit</span>, <span class="va">nd</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dietData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predictionData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span>,
              color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"longdash"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predictionData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">fit</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="lab11_ANCOVA_files/figure-html/unnamed-chunk-6-1.png" width="384" style="display: block; margin: auto;"></p>
<hr>
<p>Note that in this simple case, you could use the built in <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth()</a></code> in <code>ggplot2</code> to plot the regression line, though that will not always work. <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> is a more general method for creating and plotting regression lines from fitted models.</p>
<hr>
<p>It’s clear that there is a strong, positive relationship between length and weight (the <em>p</em>-value for the slope coefficient for <code>length</code> is so small that <code>R</code> rounds it to 0). If we want to quantify whether there is an effect of diet on weight, we will clearly need to control for length in our analysis.</p>
</div>
<div id="one-way-anova-using-lm" class="section level2">
<h2 class="hasAnchor">
<a href="#one-way-anova-using-lm" class="anchor"></a>One-way ANOVA using <code>lm()</code>
</h2>
<p>We can also fit the conventional one-way ANOVA using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. We do that by changing the <code>contrasts=</code> argument so that the estimates will correspond to the additive model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">diet</span>, <span class="va">dietData</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>diet<span class="op">=</span><span class="st">"contr.sum"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/summary.aov.html">summary.aov</a></span><span class="op">(</span><span class="va">fm2</span><span class="op">)</span>
<span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; diet         3     55   18.22    2.05   0.12</span>
<span class="co">#&gt; Residuals   56    497    8.87</span></code></pre></div>
<hr>
<p>As always in <code>R</code>, there are multiple ways to do any task. The <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> function gives identical results to the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function above:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">diet</span>, <span class="va">dietData</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>diet<span class="op">=</span><span class="st">"contr.sum"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; diet         3     55   18.22    2.05   0.12</span>
<span class="co">#&gt; Residuals   56    497    8.87</span></code></pre></div>
<hr>
<p>Note that <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> will return an alternative output compared to <code><a href="https://rdrr.io/r/stats/summary.aov.html">summary.aov()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = weight ~ diet, data = dietData, contrasts = list(diet = "contr.sum"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt; -7.637 -1.925 -0.037  1.977  5.458 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)  27.1396     0.3846   70.57   &lt;2e-16 ***</span>
<span class="co">#&gt; diet1        -1.0218     0.6661   -1.53     0.13    </span>
<span class="co">#&gt; diet2        -0.5659     0.6661   -0.85     0.40    </span>
<span class="co">#&gt; diet3         0.0803     0.6661    0.12     0.90    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 2.98 on 56 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.0991, Adjusted R-squared:  0.0508 </span>
<span class="co">#&gt; F-statistic: 2.05 on 3 and 56 DF,  p-value: 0.117</span></code></pre></div>
<p>Because we:</p>
<ol style="list-style-type: decimal">
<li><p>Set the contrast argument to <code>contrast="contr.sum"</code>, and</p></li>
<li><p>centered the length covariate,</p></li>
</ol>
<p>the intercept is the grand mean (<span class="math inline">\(\mu\)</span>) and the other estimates are the effect sizes (<span class="math inline">\(\alpha_i\)</span>).</p>
<p>Also note that you can set the behavior for all subsequent <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> or <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> calls, by setting <code>R</code>’s options:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>contrasts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contr.sum"</span>, <span class="st">"contr.poly"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And to check the value of an option:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"contrasts"</span><span class="op">)</span></code></pre></div>
<hr>
<p>Note that Options are reset every time you close and reopen <code>R</code></p>
<hr>
<p>As we saw earlier, the predict function can also be used to obtain group means, SEs, and CIs from a one-way ANOVA:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>diet<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">dietData</span><span class="op">$</span><span class="va">diet</span><span class="op">)</span><span class="op">)</span>
<span class="va">E2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fm2</span>, newdata<span class="op">=</span><span class="va">nd2</span>,
se.fit<span class="op">=</span><span class="cn">TRUE</span>, interval<span class="op">=</span><span class="st">"confidence"</span><span class="op">)</span>
<span class="op">(</span><span class="va">predData2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">E2</span><span class="op">$</span><span class="va">fit</span>, <span class="va">nd2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;     fit   lwr   upr    diet</span>
<span class="co">#&gt; 1 26.12 24.58 27.66 Control</span>
<span class="co">#&gt; 2 26.57 25.03 28.11     Low</span>
<span class="co">#&gt; 3 27.22 25.68 28.76     Med</span>
<span class="co">#&gt; 4 28.65 27.11 30.19    High</span>

<span class="va">predData2</span><span class="op">$</span><span class="va">diet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">predData2</span><span class="op">$</span><span class="va">diet</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Low"</span>, <span class="st">"Med"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">predData2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diet</span>, y <span class="op">=</span> <span class="va">fit</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diet</span>, ymin <span class="op">=</span> <span class="va">lwr</span>, ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Weight"</span><span class="op">)</span> </code></pre></div>
<p><img src="lab11_ANCOVA_files/figure-html/unnamed-chunk-12-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="ancova" class="section level2">
<h2 class="hasAnchor">
<a href="#ancova" class="anchor"></a>ANCOVA</h2>
<p>Recall the additive model:</p>
<p><span class="math display">\[\Large y_{ij} = \mu + \alpha_i + \beta(x_{ij} − \bar{x}) + \epsilon_{ij}\]</span></p>
<p>Make sure the contrasts are set as before:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>contrasts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contr.sum"</span>, <span class="st">"contr.poly"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Centering the covariate isn’t required, but doing so allows the intercept to be interpreted as the grand mean:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dietData</span><span class="op">$</span><span class="va">lengthCentered</span> <span class="op">&lt;-</span> <span class="va">dietData</span><span class="op">$</span><span class="va">length</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dietData</span><span class="op">$</span><span class="va">length</span><span class="op">)</span></code></pre></div>
<p>Now we can fit the model using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">lengthCentered</span> <span class="op">+</span> <span class="va">diet</span>, <span class="va">dietData</span><span class="op">)</span></code></pre></div>
<hr>
<p>Always put the covariate before the treatment variable in the formula. With ANCOVA, we want to assess treatment effects <em>after</em> accounting for the continuous covariate</p>
<hr>
<div id="aside-dummy-variables-and-contrasts" class="section level3">
<h3 class="hasAnchor">
<a href="#aside-dummy-variables-and-contrasts" class="anchor"></a>Aside: Dummy variables and contrasts<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h3>
<p>Understanding and interpreting parameters from complex linear models can be challenging. If you are unsure about what <code>R</code> is doing under the hood with factors, contrasts (and interactions), a great place to start is looking at the model matrix. To do that, we need to better understand how the model matrix is constructed.</p>
<p>Let’s start by creating two new versions of the diet data frame. We’ll also set the factor levels and center the length data on one of the new data frames:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df.orig</span> <span class="op">&lt;-</span> <span class="va">dietData</span>

<span class="va">df</span><span class="op">$</span><span class="va">diet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">diet</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">diet</span><span class="op">)</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">length</span><span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">length</span><span class="op">)</span>       <span class="co">###  Center df$girth</span></code></pre></div>
<p>Now, fit a linear model (first check the default contrasts):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"contrasts"</span><span class="op">)</span> 
<span class="co">#&gt; $contrasts</span>
<span class="co">#&gt; [1] "contr.sum"  "contr.poly"</span>
<span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">length</span> <span class="op">+</span> <span class="va">diet</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></code></pre></div>
<p>And look at the estimated coefficients:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="co">#&gt; (Intercept)      length       diet1       diet2       diet3 </span>
<span class="co">#&gt;     27.1396      0.5573     -1.7446     -0.3758      0.7819</span></code></pre></div>
<p>Because <code>contr.treatment</code> was used, <code>(Intercept)</code> represents the mean of the Control group, at the mean value of length (which we have set to 0).</p>
<p>Now let’s look at the model matrix using the <code><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix()</a></code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="co">#&gt;    (Intercept)  length diet1 diet2 diet3</span>
<span class="co">#&gt; 1            1  0.3990     1     0     0</span>
<span class="co">#&gt; 2            1  2.3322     1     0     0</span>
<span class="co">#&gt; 3            1  4.1341     1     0     0</span>
<span class="co">#&gt; 4            1 -3.2730     1     0     0</span>
<span class="co">#&gt; 5            1 -5.7294     1     0     0</span>
<span class="co">#&gt; 6            1  7.6517     1     0     0</span>
<span class="co">#&gt; 7            1  1.5881     1     0     0</span>
<span class="co">#&gt; 8            1  6.1792     1     0     0</span>
<span class="co">#&gt; 9            1 -3.8436     1     0     0</span>
<span class="co">#&gt; 10           1  7.3886     1     0     0</span>
<span class="co">#&gt; 11           1 -5.2661     1     0     0</span>
<span class="co">#&gt; 12           1  6.5513     1     0     0</span>
<span class="co">#&gt; 13           1 -4.1749     1     0     0</span>
<span class="co">#&gt; 14           1  4.8042     1     0     0</span>
<span class="co">#&gt; 15           1  0.7117     1     0     0</span>
<span class="co">#&gt; 16           1  1.6993     0     1     0</span>
<span class="co">#&gt; 17           1  5.5913     0     1     0</span>
<span class="co">#&gt; 18           1  0.9654     0     1     0</span>
<span class="co">#&gt; 19           1 -4.7199     0     1     0</span>
<span class="co">#&gt; 20           1 -2.5990     0     1     0</span>
<span class="co">#&gt; 21           1 -0.9637     0     1     0</span>
<span class="co">#&gt; 22           1 -0.6864     0     1     0</span>
<span class="co">#&gt; 23           1  3.8912     0     1     0</span>
<span class="co">#&gt; 24           1  3.8348     0     1     0</span>
<span class="co">#&gt; 25           1 -1.7078     0     1     0</span>
<span class="co">#&gt; 26           1 -2.2548     0     1     0</span>
<span class="co">#&gt; 27           1 -6.2127     0     1     0</span>
<span class="co">#&gt; 28           1 -5.5085     0     1     0</span>
<span class="co">#&gt; 29           1  0.7417     0     1     0</span>
<span class="co">#&gt; 30           1  2.8120     0     1     0</span>
<span class="co">#&gt; 31           1 -3.2221     0     0     1</span>
<span class="co">#&gt; 32           1 -3.7347     0     0     1</span>
<span class="co">#&gt; 33           1  2.6719     0     0     1</span>
<span class="co">#&gt; 34           1 -2.8936     0     0     1</span>
<span class="co">#&gt; 35           1 -4.3085     0     0     1</span>
<span class="co">#&gt; 36           1 -5.9606     0     0     1</span>
<span class="co">#&gt; 37           1  3.9533     0     0     1</span>
<span class="co">#&gt; 38           1 -1.8963     0     0     1</span>
<span class="co">#&gt; 39           1 -5.6403     0     0     1</span>
<span class="co">#&gt; 40           1  6.4741     0     0     1</span>
<span class="co">#&gt; 41           1 -3.5908     0     0     1</span>
<span class="co">#&gt; 42           1 -1.4293     0     0     1</span>
<span class="co">#&gt; 43           1  0.5732     0     0     1</span>
<span class="co">#&gt; 44           1 -3.3137     0     0     1</span>
<span class="co">#&gt; 45           1  3.4332     0     0     1</span>
<span class="co">#&gt; 46           1 -2.2681    -1    -1    -1</span>
<span class="co">#&gt; 47           1 -2.1892    -1    -1    -1</span>
<span class="co">#&gt; 48           1 -1.1385    -1    -1    -1</span>
<span class="co">#&gt; 49           1  5.2521    -1    -1    -1</span>
<span class="co">#&gt; 50           1  5.7010    -1    -1    -1</span>
<span class="co">#&gt; 51           1 -1.3168    -1    -1    -1</span>
<span class="co">#&gt; 52           1  6.7679    -1    -1    -1</span>
<span class="co">#&gt; 53           1 -5.5258    -1    -1    -1</span>
<span class="co">#&gt; 54           1 -4.0120    -1    -1    -1</span>
<span class="co">#&gt; 55           1 -2.0205    -1    -1    -1</span>
<span class="co">#&gt; 56           1 -3.4903    -1    -1    -1</span>
<span class="co">#&gt; 57           1  5.9692    -1    -1    -1</span>
<span class="co">#&gt; 58           1 -5.0943    -1    -1    -1</span>
<span class="co">#&gt; 59           1  6.1821    -1    -1    -1</span>
<span class="co">#&gt; 60           1  1.7311    -1    -1    -1</span>
<span class="co">#&gt; attr(,"assign")</span>
<span class="co">#&gt; [1] 0 1 2 2 2</span>
<span class="co">#&gt; attr(,"contrasts")</span>
<span class="co">#&gt; attr(,"contrasts")$diet</span>
<span class="co">#&gt; [1] "contr.sum"</span></code></pre></div>
<p>Remember that, in the model matrix, there is <strong>one row for each observation</strong> in the data and <strong>one column for each parameter in the model</strong>. In this case, the columns correspond to:</p>
<ol style="list-style-type: decimal">
<li>the intercept (= 1 for all observations)</li>
<li>the value of continuous covariate for each observation, 3-5) the factor levels</li>
</ol>
<p>At the bottom of print out, this function also tells you the contrasts used.</p>
<p>For factor levels (the final three columns in this case), the model matrix gives the values of the ‘dummy variables’ used to represent the factor diet. There will always be <span class="math inline">\(a-1\)</span> dummy variables for a factor with a groups.</p>
<p>Why are there <span class="math inline">\(a-1\)</span> dummy variables instead of <span class="math inline">\(a\)</span>? Notice that the Control group is not in the design matrix. It has been taken as the “reference condition”: its mean is represented by the intercept. Where observations belong to the Control group, all the dummy variables have a value of 0.</p>
<p>To get the expected response for a particular observation, say row 1 of the data, we simply take the dot product (that is, a <em>linear combination</em>) of the coefficients with the appropriate row of the design matrix:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 25.62</span>
<span class="co">### in other words:</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>
<span class="co">#&gt;       [,1]</span>
<span class="co">#&gt; [1,] 25.62</span></code></pre></div>
<p>To do this for all rows in one go, use matrix multiplication:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;          1     2    3     4    5     6     7     8     9    10    11    12</span>
<span class="co">#&gt; [1,] 25.62 26.69 27.7 23.57 22.2 29.66 26.28 28.84 23.25 29.51 22.46 29.05</span>
<span class="co">#&gt;         13    14    15    16    17   18    19    20    21    22    23   24</span>
<span class="co">#&gt; [1,] 23.07 28.07 25.79 27.71 29.88 27.3 24.13 25.32 26.23 26.38 28.93 28.9</span>
<span class="co">#&gt;         25    26   27    28    29    30    31    32    33    34    35   36</span>
<span class="co">#&gt; [1,] 25.81 25.51 23.3 23.69 27.18 28.33 26.13 25.84 29.41 26.31 25.52 24.6</span>
<span class="co">#&gt;         37    38    39    40    41    42    43    44    45    46    47    48</span>
<span class="co">#&gt; [1,] 30.12 26.86 24.78 31.53 25.92 27.12 28.24 26.07 29.83 27.21 27.26 27.84</span>
<span class="co">#&gt;         49    50    51    52   53    54    55    56   57    58    59    60</span>
<span class="co">#&gt; [1,] 31.41 31.66 27.74 32.25 25.4 26.24 27.35 26.53 31.8 25.64 31.92 29.44</span></code></pre></div>
<p>What’s with the <code><a href="https://rdrr.io/r/base/t.html">t()</a></code> function? If you’re unsure, now’s a good time to review matrix multiplication.</p>
<p>Next, what happens when we use <code>contr.sum</code>, or sum-to-zero contrasts?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">length</span> <span class="op">+</span> <span class="va">diet</span>, data <span class="op">=</span> <span class="va">df</span>, contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>diet<span class="op">=</span><span class="st">"contr.sum"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span>
<span class="co">#&gt; (Intercept)      length       diet1       diet2       diet3 </span>
<span class="co">#&gt;     27.1396      0.5573     -1.7446     -0.3758      0.7819</span></code></pre></div>
<p>The <code>(Intercept)</code> now represents the Grand Mean (because we centered length). Also notice that the factor level now missing is <code>High</code>. Where did it go? Actually, we don’t need it because the effect of <code>High</code> can be calculated as <code>Grand.Mean - sum(diet1, diet2, diet3)</code>.</p>
<p>How do you know what the intercept represents in this case? The design matrix!</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span>
<span class="co">#&gt;    (Intercept)  length diet1 diet2 diet3</span>
<span class="co">#&gt; 1            1  0.3990     1     0     0</span>
<span class="co">#&gt; 2            1  2.3322     1     0     0</span>
<span class="co">#&gt; 3            1  4.1341     1     0     0</span>
<span class="co">#&gt; 4            1 -3.2730     1     0     0</span>
<span class="co">#&gt; 5            1 -5.7294     1     0     0</span>
<span class="co">#&gt; 6            1  7.6517     1     0     0</span>
<span class="co">#&gt; 7            1  1.5881     1     0     0</span>
<span class="co">#&gt; 8            1  6.1792     1     0     0</span>
<span class="co">#&gt; 9            1 -3.8436     1     0     0</span>
<span class="co">#&gt; 10           1  7.3886     1     0     0</span>
<span class="co">#&gt; 11           1 -5.2661     1     0     0</span>
<span class="co">#&gt; 12           1  6.5513     1     0     0</span>
<span class="co">#&gt; 13           1 -4.1749     1     0     0</span>
<span class="co">#&gt; 14           1  4.8042     1     0     0</span>
<span class="co">#&gt; 15           1  0.7117     1     0     0</span>
<span class="co">#&gt; 16           1  1.6993     0     1     0</span>
<span class="co">#&gt; 17           1  5.5913     0     1     0</span>
<span class="co">#&gt; 18           1  0.9654     0     1     0</span>
<span class="co">#&gt; 19           1 -4.7199     0     1     0</span>
<span class="co">#&gt; 20           1 -2.5990     0     1     0</span>
<span class="co">#&gt; 21           1 -0.9637     0     1     0</span>
<span class="co">#&gt; 22           1 -0.6864     0     1     0</span>
<span class="co">#&gt; 23           1  3.8912     0     1     0</span>
<span class="co">#&gt; 24           1  3.8348     0     1     0</span>
<span class="co">#&gt; 25           1 -1.7078     0     1     0</span>
<span class="co">#&gt; 26           1 -2.2548     0     1     0</span>
<span class="co">#&gt; 27           1 -6.2127     0     1     0</span>
<span class="co">#&gt; 28           1 -5.5085     0     1     0</span>
<span class="co">#&gt; 29           1  0.7417     0     1     0</span>
<span class="co">#&gt; 30           1  2.8120     0     1     0</span>
<span class="co">#&gt; 31           1 -3.2221     0     0     1</span>
<span class="co">#&gt; 32           1 -3.7347     0     0     1</span>
<span class="co">#&gt; 33           1  2.6719     0     0     1</span>
<span class="co">#&gt; 34           1 -2.8936     0     0     1</span>
<span class="co">#&gt; 35           1 -4.3085     0     0     1</span>
<span class="co">#&gt; 36           1 -5.9606     0     0     1</span>
<span class="co">#&gt; 37           1  3.9533     0     0     1</span>
<span class="co">#&gt; 38           1 -1.8963     0     0     1</span>
<span class="co">#&gt; 39           1 -5.6403     0     0     1</span>
<span class="co">#&gt; 40           1  6.4741     0     0     1</span>
<span class="co">#&gt; 41           1 -3.5908     0     0     1</span>
<span class="co">#&gt; 42           1 -1.4293     0     0     1</span>
<span class="co">#&gt; 43           1  0.5732     0     0     1</span>
<span class="co">#&gt; 44           1 -3.3137     0     0     1</span>
<span class="co">#&gt; 45           1  3.4332     0     0     1</span>
<span class="co">#&gt; 46           1 -2.2681    -1    -1    -1</span>
<span class="co">#&gt; 47           1 -2.1892    -1    -1    -1</span>
<span class="co">#&gt; 48           1 -1.1385    -1    -1    -1</span>
<span class="co">#&gt; 49           1  5.2521    -1    -1    -1</span>
<span class="co">#&gt; 50           1  5.7010    -1    -1    -1</span>
<span class="co">#&gt; 51           1 -1.3168    -1    -1    -1</span>
<span class="co">#&gt; 52           1  6.7679    -1    -1    -1</span>
<span class="co">#&gt; 53           1 -5.5258    -1    -1    -1</span>
<span class="co">#&gt; 54           1 -4.0120    -1    -1    -1</span>
<span class="co">#&gt; 55           1 -2.0205    -1    -1    -1</span>
<span class="co">#&gt; 56           1 -3.4903    -1    -1    -1</span>
<span class="co">#&gt; 57           1  5.9692    -1    -1    -1</span>
<span class="co">#&gt; 58           1 -5.0943    -1    -1    -1</span>
<span class="co">#&gt; 59           1  6.1821    -1    -1    -1</span>
<span class="co">#&gt; 60           1  1.7311    -1    -1    -1</span>
<span class="co">#&gt; attr(,"assign")</span>
<span class="co">#&gt; [1] 0 1 2 2 2</span>
<span class="co">#&gt; attr(,"contrasts")</span>
<span class="co">#&gt; attr(,"contrasts")$diet</span>
<span class="co">#&gt; [1] "contr.sum"</span></code></pre></div>
<p>Look carefully at the matrix (it might help to estimate the expected value for a few observations “by hand” to see how the dummy variables add or take away each parameters for different treatments).</p>
<p>So we can see that the design matrix has changed simply because we used different contrasts in the model but did the fitted values change?</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">)</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span><span class="op">)</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Did the residuals change?</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>No indeed. Specifying different contrasts in this way is called a <code>re-parameterization</code> of the model. It’s a different way of doing the arithmetic of the linear model, but it comes out to the same thing. We choose a parameterization based on how we want to interpret the results. For ANOVA or ANCOVA, that’s usually sum-to-zero contrasts using <code>contr.sum</code>.</p>
</div>
</div>
<div id="back-to-the-ancova" class="section level2">
<h2 class="hasAnchor">
<a href="#back-to-the-ancova" class="anchor"></a>Back to the ANCOVA</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm3</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = weight ~ lengthCentered + diet, data = dietData)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt; -3.821 -1.221 -0.252  1.216  4.919 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)     27.1396     0.2406  112.79  &lt; 2e-16 ***</span>
<span class="co">#&gt; lengthCentered   0.5573     0.0594    9.38  5.2e-13 ***</span>
<span class="co">#&gt; diet1           -1.7446     0.4238   -4.12  0.00013 ***</span>
<span class="co">#&gt; diet2           -0.3758     0.4173   -0.90  0.37171    </span>
<span class="co">#&gt; diet3            0.7819     0.4234    1.85  0.07020 .  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.86 on 55 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.654,  Adjusted R-squared:  0.628 </span>
<span class="co">#&gt; F-statistic: 25.9 on 4 and 55 DF,  p-value: 4.15e-12</span></code></pre></div>
<p>Note that the null hypothesis of no diet effect is rejected, even though it was not rejected before.</p>
<p>It may also be helpful to view the ANOVA table using:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/summary.aov.html">summary.aov</a></span><span class="op">(</span><span class="va">fm3</span><span class="op">)</span>
<span class="co">#&gt;                Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span>
<span class="co">#&gt; lengthCentered  1  278.3   278.3   80.09 2.5e-12 ***</span>
<span class="co">#&gt; diet            3   82.2    27.4    7.89 0.00018 ***</span>
<span class="co">#&gt; Residuals      55  191.1     3.5                    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>And as before, we can create predictions of weight over a sequences of lengths, for every level of diet:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengthC</span> <span class="op">&lt;-</span> <span class="va">dietData</span><span class="op">$</span><span class="va">lengthCentered</span>
<span class="va">nd3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>diet<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Low"</span>, <span class="st">"Med"</span>, <span class="st">"High"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
                  lengthCentered<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lengthC</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lengthC</span><span class="op">)</span>,length <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">E3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fm3</span>, newdata<span class="op">=</span><span class="va">nd3</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span>
<span class="va">predData3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">E3</span><span class="op">$</span><span class="va">fit</span>, <span class="va">nd3</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dietData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lengthCentered</span>, y <span class="op">=</span> <span class="va">weight</span>, color <span class="op">=</span> <span class="va">diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">predData3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lengthCentered</span>, y <span class="op">=</span> <span class="va">fit</span>, color <span class="op">=</span> <span class="va">diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span><span class="st">"Weight"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span><span class="st">"Length"</span><span class="op">)</span></code></pre></div>
<p><img src="lab11_ANCOVA_files/figure-html/unnamed-chunk-28-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We can also look at multiple comparisons using:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org">multcomp</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht</a></span><span class="op">(</span><span class="va">fm3</span>, linfct<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp</a></span><span class="op">(</span>diet<span class="op">=</span><span class="st">"Tukey"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multiple Comparisons of Means: Tukey Contrasts</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fit: lm(formula = weight ~ lengthCentered + diet, data = dietData)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Linear Hypotheses:</span>
<span class="co">#&gt;                     Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; Low - Control == 0     1.369      0.688    1.99   0.2038    </span>
<span class="co">#&gt; Med - Control == 0     2.526      0.697    3.62   0.0032 ** </span>
<span class="co">#&gt; High - Control == 0    3.083      0.683    4.51   &lt;0.001 ***</span>
<span class="co">#&gt; Med - Low == 0         1.158      0.683    1.70   0.3358    </span>
<span class="co">#&gt; High - Low == 0        1.714      0.682    2.51   0.0686 .  </span>
<span class="co">#&gt; High - Med == 0        0.557      0.687    0.81   0.8493    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></code></pre></div>
</div>
</div>
<div id="assignment" class="section level1">
<h1 class="hasAnchor">
<a href="#assignment" class="anchor"></a>Assignment</h1>
<p>Complete the following and upload your R markdown file to ELC before next week.</p>
<ol style="list-style-type: decimal">
<li><p>Fit an ANCOVA model to the <code>treeData</code> data set, which represent the height of trees following a fertilizer experiment. The covariate is pH.</p></li>
<li><p>Use sum-to-zero contrasts (<code>contr.sum</code>) so that your estimates correspond to the additive model from the lecture notes.</p></li>
<li><p>Interpret each of the estimates from <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. What is the null hypothesis associated with each p-value?</p></li>
<li><p>Plot the data and the regression lines. Use different colors or symbols to distinguish the treatment groups.</p></li>
<li><p>Which fertilizer treatments are significantly different?</p></li>
</ol>
<p>You may format the report however you like but it should be well-organized, with relevant headers, plain text, and the elements described above.</p>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to: <code>output: html_document</code></p></li>
<li><p>Title the document: <code>title: "Lab 11 assignment"</code></p></li>
<li><p>Be sure to include your first and last name in the <code>author</code> section</p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code> chunks so we can see both your code and the output</p></li>
<li><p>Please upload both the <code>html</code> and <code>.Rmd</code> files when you submit your assignment</p></li>
<li><p>See the R Markdown reference sheet for help with creating <code>R</code> chunks, equations, tables, etc.</p></li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>h/t to Bryan Nuse for this material<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
