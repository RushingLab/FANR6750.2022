<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 6: Randomized Complete Block Design • FANR6750</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 6: Randomized Complete Block Design">
<meta property="og:description" content="FANR6750">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FANR6750</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2021.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/01_basic_stats/01_basic_stats.html">Lecture 1: Basic concepts in statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/02_t-tests/02_t-tests.html">Lecture 2: t-tests</a>
    </li>
    <li>
      <a href="../articles/lectures/03_anova/03_anova.html">Lecture 3: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/04_mult_comparisons/04_mult_comparisons.html">Lecture 4: Multiple comparisons</a>
    </li>
    <li>
      <a href="../articles/lectures/05_contrasts/05_contrasts.html">Lecture 5: Contrasts</a>
    </li>
    <li>
      <a href="../articles/lectures/06_power-analysis/06_power-analysis.html">Lecture 6: Power analysis</a>
    </li>
    <li>
      <a href="../articles/lectures/07_estimation/07_estimation.html">Lecture 7: Estimation</a>
    </li>
    <li>
      <a href="../articles/lectures/08_assumptions/08_assumptions.html">Lecture 8: ANOVA assumptions</a>
    </li>
    <li>
      <a href="../articles/lectures/09_nonparametrics/09_nonparametrics.html">Lecture 9: Non-parametric statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/10_blocking/10_blocking.html">Lecture 10: Blocking</a>
    </li>
    <li>
      <a href="../articles/lectures/11_raneff/11_raneff.html">Lecture 11: Random effects</a>
    </li>
    <li>
      <a href="../articles/lectures/12_factorial/12_factorial.html">Lecture 12: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lectures/13_nesting/13_nesting.html">Lecture 13: Nested designs</a>
    </li>
    <li>
      <a href="../articles/lectures/14_splitplot/14_splitplot.html">Lecture 14: Split plot designs</a>
    </li>
    <li>
      <a href="../articles/lectures/15_repeated_measures/15_repeated_measures.html">Lecture 15: Repeated measures</a>
    </li>
    <li>
      <a href="../articles/lectures/16_ANCOVA/16_ANCOVA.html">Lecture 16: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/17_lm/17_lm.html">Lecture 17: Linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/18_glm/18_glm.html">Lecture 18: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/19_model_selection/19_model_selection.html">Lecture 19: Model selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab01_Intro_to_R.html">Lab 1: Introduction to R</a>
    </li>
    <li>
      <a href="../articles/lab02_t-tests.html">Lab 2: t-tests</a>
    </li>
    <li>
      <a href="../articles/lab03_ANOVA.html">Lab 3: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab04_contrasts.html">Lab 4: Contrasts, estimation, and power analysis</a>
    </li>
    <li>
      <a href="../articles/lab05_assump_nonpar.html">Lab 5: Assumptions of ANOVA, tranformations, and non-parametric tests</a>
    </li>
    <li>
      <a href="../articles/lab06_blocking.html">Lab 6: Randomized Complete Block Design</a>
    </li>
    <li>
      <a href="../articles/lab07_factorial.html">Lab 7: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lab08_nested.html">Lab 8: Nested ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab09_splitplot.html">Lab 9: Split plot designs</a>
    </li>
    <li>
      <a href="../articles/lab10_repeated_measures.html">Lab 10: Repeated measures</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework.html">Assignment instructions</a>
    </li>
    <li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/Rmarkdown.html">R Markdown reference</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lab06_blocking_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 6: Randomized Complete Block Design</h1>
            <h3 class="subtitle">FANR 6750: Experimental Methods in Forestry and Natural Resources Research</h3>
                        <h4 class="author">Fall 2021</h4>
            
      
      
      <div class="hidden name"><code>lab06_blocking.Rmd</code></div>

    </div>

    
    
<div id="recap" class="section level1">
<h1 class="hasAnchor">
<a href="#recap" class="anchor"></a>Recap</h1>
<p>Remember from lecture that randomized complete block design (RCBD) is like one-way ANOVA except experimental units are organized into blocks to account for extraneous source of variation.</p>
<p>Blocks can be regions, time periods, individual subjects, etc. but blocking must occur <strong>during the design phase</strong> of the study.</p>
<p>We can write the additive RCBD model as:</p>
<p><span class="math display">\[\large y_{ij} = \mu + \alpha_i + \beta_j + \epsilon_{ij}\]</span></p>
</div>
<div id="blocked-anova-by-hand" class="section level1">
<h1 class="hasAnchor">
<a href="#blocked-anova-by-hand" class="anchor"></a>Blocked ANOVA by hand</h1>
<p>To “fit” the RCBD model by hand, we’ll use the gypsy moth data we saw in lecture:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"mothData"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">Treatment</th>
<th align="center">Region</th>
<th align="center">caterpillar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Control</td>
<td align="center">1</td>
<td align="center">25</td>
</tr>
<tr class="even">
<td align="center">Control</td>
<td align="center">2</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center">Control</td>
<td align="center">3</td>
<td align="center">15</td>
</tr>
<tr class="even">
<td align="center">Control</td>
<td align="center">4</td>
<td align="center">32</td>
</tr>
<tr class="odd">
<td align="center">Bt</td>
<td align="center">1</td>
<td align="center">16</td>
</tr>
<tr class="even">
<td align="center">Bt</td>
<td align="center">2</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
<div id="factors" class="section level2">
<h2 class="hasAnchor">
<a href="#factors" class="anchor"></a>Factors</h2>
<p>So far, we have generally treated data as either numeric/integer if the vector consisted of numbers, or character if the data consisted of non-numeric information. To perform the RCBD analysis, we need to learn about another type of object in <code>R</code> - factors.</p>
<p>Factors look like character strings but they behave quite differently, and understanding the way that <code>R</code> handles factors is key to working this type of data. The key difference between factors and character strings is that factors are used to represent <em>categorical</em> data with a fixed number of possible values, called <em>levels</em><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>Factors can be created using the <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"adult"</span>, <span class="st">"juvenile"</span>, <span class="st">"adult"</span>, <span class="st">"juvenile"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Because we didn’t explicitly tell <code>R</code> the levels of this factor, it will assume the levels are <em>adult</em> and <em>juvenile</em>. Furthermore, by default <code>R</code> assigns levels in alphabetical order, so <code>adult</code> will be the first level and <code>juvenile</code> will be the second level:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>
<span class="co">#&gt; [1] "adult"    "juvenile"</span></code></pre></div>
<p>Sometimes alphabetical order might not make sense:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"medium"</span>, <span class="st">"low"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<hr>
<p>What order will <code>R</code> assign to the treatment levels?</p>
<hr>
<p>If you want to order the factor in a different way, you can use the optional <code>levels</code> argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span>
<span class="co">#&gt; [1] "low"    "medium" "high"</span></code></pre></div>
<p>Sometimes you may also need to remove factor levels. For example, let’s see what happens if we have a type in one of the factors:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"Male"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="lab06_blocking_files/figure-html/unnamed-chunk-6-1.png" width="384"></p>
<p>Oops, one of the field techs accidentally capitalized “Male”. Let’s change that to lowercase:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sex</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"male"</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="lab06_blocking_files/figure-html/unnamed-chunk-7-1.png" width="384"></p>
<p>Hmm, there’s still a bar for <code>Male</code>. We can see what’s happening here by looking at the levels:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>
<span class="co">#&gt; [1] "female" "male"   "Male"</span></code></pre></div>
<p>Removing/editing the factors doesn’t change the levels! So <code>R</code> still thinks there are three levels, just zero <code>Male</code> entries. To remove that mis-specified level, we need to drop it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="lab06_blocking_files/figure-html/unnamed-chunk-9-1.png" width="384"></p>
<p>That’s better.</p>
<p>The bottom line is be careful when working with factors, since their behavior is not always intuitive. There are more great online resources for working with factors in <code>R</code>, including <a href="https://swcarpentry.github.io/r-novice-inflammation/12-supp-factors/">this tutorial</a> and even a package (<a href="https://forcats.tidyverse.org/">forcats</a>) that tries to make it a bit easier.</p>
</div>
<div id="back-to-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#back-to-the-data" class="anchor"></a>Back to the data</h2>
<p>Before we analyze the moth data, we need to tell <code>R</code> to treat the <code>Treatment</code> and <code>Plot</code> variables as factors:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    12 obs. of  3 variables:</span>
<span class="co">#&gt;  $ Treatment  : chr  "Control" "Control" "Control" "Control" ...</span>
<span class="co">#&gt;  $ Region     : int  1 2 3 4 1 2 3 4 1 2 ...</span>
<span class="co">#&gt;  $ caterpillar: num  25 10 15 32 16 3 10 18 14 2 ...</span></code></pre></div>
<p>Right now, they are character and integer objects, respectively.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mothData</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">Treatment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Bt"</span>, <span class="st">"Dimilin"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span>
<span class="co">#&gt; [1] "Control" "Bt"      "Dimilin"</span>

<span class="va">mothData</span><span class="op">$</span><span class="va">Region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span>
<span class="co">#&gt; [1] "1" "2" "3" "4"</span></code></pre></div>
<p>Note that we were explicit about the order of levels for <code>Treatment</code> so that controls came first.</p>
<div id="means" class="section level3">
<h3 class="hasAnchor">
<a href="#means" class="anchor"></a>Means</h3>
<p>Next, compute the means:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co"># Grand mean</span>
<span class="op">(</span><span class="va">grand.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">caterpillar</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 14.41667</span>

<span class="co"># Treatment means</span>
<span class="op">(</span><span class="va">treatment.means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mothData</span>, <span class="va">Treatment</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">caterpillar</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   Treatment    mu</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Control    20.5</span>
<span class="co">#&gt; 2 Bt         11.8</span>
<span class="co">#&gt; 3 Dimilin    11</span>

<span class="co"># Block means</span>
<span class="op">(</span><span class="va">block.means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mothData</span>, <span class="va">Region</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">caterpillar</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;   Region    mu</span>
<span class="co">#&gt;   &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1       18.3</span>
<span class="co">#&gt; 2 2        5  </span>
<span class="co">#&gt; 3 3       13.7</span>
<span class="co">#&gt; 4 4       20.7</span></code></pre></div>
</div>
<div id="treatment-sums-of-squares" class="section level3">
<h3 class="hasAnchor">
<a href="#treatment-sums-of-squares" class="anchor"></a>Treatment sums of squares</h3>
<p>Remember the formula for the treatment sums of squares</p>
<p><span class="math display">\[\Large b \times \sum_{i=1}^a (\bar{y}_i - \bar{y}_.)^2\]</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nlevels.html">nlevels</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span>
<span class="op">(</span><span class="va">SS.treat</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">treatment.means</span><span class="op">$</span><span class="va">mu</span> <span class="op">-</span> <span class="va">grand.mean</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 223.1667</span></code></pre></div>
</div>
<div id="block-sums-of-squares" class="section level3">
<h3 class="hasAnchor">
<a href="#block-sums-of-squares" class="anchor"></a>Block sums of squares</h3>
<p>The formula for the block sums of squares</p>
<p><span class="math display">\[\Large a \times \sum_{j=1}^b (\bar{y}_j - \bar{y}_.)^2\]</span></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nlevels.html">nlevels</a></span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">Treatment</span><span class="op">)</span>
<span class="op">(</span><span class="va">SS.block</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">block.means</span><span class="op">$</span><span class="va">mu</span> <span class="op">-</span> <span class="va">grand.mean</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 430.9167</span></code></pre></div>
</div>
<div id="within-groups-sums-of-squares" class="section level3">
<h3 class="hasAnchor">
<a href="#within-groups-sums-of-squares" class="anchor"></a>Within groups sums of squares</h3>
<p><span class="math display">\[\Large \sum_{i=1}^a \sum_{j=1}^b (y_{ij} - \bar{y}_i - \bar{y}_j + \bar{y}_.)^2\]</span></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">treatment.means.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">treatment.means</span><span class="op">$</span><span class="va">mu</span>, each <span class="op">=</span> <span class="va">b</span><span class="op">)</span>
<span class="va">block.means.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">block.means</span><span class="op">$</span><span class="va">mu</span>, times <span class="op">=</span> <span class="va">a</span><span class="op">)</span>
<span class="op">(</span><span class="va">SS.within</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">mothData</span><span class="op">$</span><span class="va">caterpillar</span> <span class="op">-</span> <span class="va">treatment.means.long</span> <span class="op">-</span> <span class="va">block.means.long</span> <span class="op">+</span> <span class="va">grand.mean</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 114.8333</span></code></pre></div>
<hr>
<p><strong>NOTE</strong>: For the above code to work, <code>treatment.means</code> and <code>block.means</code> must be in the same order as in the original data.</p>
<hr>
</div>
<div id="create-anova-table" class="section level3">
<h3 class="hasAnchor">
<a href="#create-anova-table" class="anchor"></a>Create ANOVA table</h3>
<p>Now we’re ready to create the ANOVA table. Start with what we’ve calculated so far:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df.treat</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">-</span> <span class="fl">1</span>
<span class="va">df.block</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">-</span> <span class="fl">1</span>
<span class="va">df.within</span> <span class="op">&lt;-</span> <span class="va">df.treat</span><span class="op">*</span><span class="va">df.block</span>
<span class="va">ANOVAtable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">df.treat</span>, <span class="va">df.block</span>, <span class="va">df.within</span><span class="op">)</span>,
                         SS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SS.treat</span>, <span class="va">SS.block</span>, <span class="va">SS.within</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">ANOVAtable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Treatment"</span>, <span class="st">"Block"</span>, <span class="st">"Within"</span><span class="op">)</span>
<span class="va">ANOVAtable</span>
<span class="co">#&gt;           df       SS</span>
<span class="co">#&gt; Treatment  2 223.1667</span>
<span class="co">#&gt; Block      3 430.9167</span>
<span class="co">#&gt; Within     6 114.8333</span></code></pre></div>
<p>Next, add the mean squares:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MSE</span> <span class="op">&lt;-</span> <span class="va">ANOVAtable</span><span class="op">$</span><span class="va">SS</span> <span class="op">/</span> <span class="va">ANOVAtable</span><span class="op">$</span><span class="va">df</span>
<span class="va">ANOVAtable</span><span class="op">$</span><span class="va">MSE</span> <span class="op">&lt;-</span> <span class="va">MSE</span> <span class="co">## makes a new column!</span></code></pre></div>
<p>Now, the <em>F</em>-values (with <code>NA</code> for error/within/residual row):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">F.stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">MSE</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">MSE</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">MSE</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">MSE</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">ANOVAtable</span><span class="op">$</span><span class="va">F.stat</span> <span class="op">&lt;-</span> <span class="va">F.stat</span></code></pre></div>
<p>Finally, the <em>p</em>-values</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">pf</a></span><span class="op">(</span><span class="va">F.stat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">pf</a></span><span class="op">(</span><span class="va">F.stat</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">ANOVAtable</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span></code></pre></div>
<hr>
<p>Quick reminder about calculating <em>p</em>-values</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span> <span class="co"># 95% of the distribution is below this value of F</span>
<span class="co">#&gt; [1] 5.143253</span>

<span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">pf</a></span><span class="op">(</span><span class="cn">F</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span> <span class="co"># Proportion of the distribution beyond this F value</span>
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>Be sure you understand what each of these functions is doing!</p>
<hr>
<p>And we’ll display the table using <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable()</a></code>, with a few options to make it look a little nicer:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>knitr.kable.NA <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="co"># leave NA cells empty</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">ANOVAtable</span>, digits <span class="op">=</span> <span class="fl">2</span>, align <span class="op">=</span> <span class="st">"c"</span>,
             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"df"</span>, <span class="st">"SS"</span>, <span class="st">"MSE"</span>, <span class="st">"F"</span>, <span class="st">"p-value"</span><span class="op">)</span>,
             caption <span class="op">=</span> <span class="st">"RCBD ANOVA table calculated by hand"</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>RCBD ANOVA table calculated by hand</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="center">df</th>
<th align="center">SS</th>
<th align="center">MSE</th>
<th align="center">F</th>
<th align="center">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Treatment</td>
<td align="center">2</td>
<td align="center">223.17</td>
<td align="center">111.58</td>
<td align="center">5.83</td>
<td align="center">0.04</td>
</tr>
<tr class="even">
<td align="left">Block</td>
<td align="center">3</td>
<td align="center">430.92</td>
<td align="center">143.64</td>
<td align="center">7.51</td>
<td align="center">0.02</td>
</tr>
<tr class="odd">
<td align="left">Within</td>
<td align="center">6</td>
<td align="center">114.83</td>
<td align="center">19.14</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="blocked-anova-using-aov" class="section level2">
<h2 class="hasAnchor">
<a href="#blocked-anova-using-aov" class="anchor"></a>Blocked ANOVA using <code>aov()</code>
</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aov1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">caterpillar</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Region</span>, <span class="va">mothData</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">aov1</span><span class="op">)</span>
<span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)  </span>
<span class="co">#&gt; Treatment    2  223.2  111.58   5.830 0.0392 *</span>
<span class="co">#&gt; Region       3  430.9  143.64   7.505 0.0187 *</span>
<span class="co">#&gt; Residuals    6  114.8   19.14                 </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>Same as what we got by hand! Look what happens if we ignore the blocking variable:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aov2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">caterpillar</span> <span class="op">~</span> <span class="va">Treatment</span>, <span class="va">mothData</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">aov2</span><span class="op">)</span>
<span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; Treatment    2  223.2  111.58    1.84  0.214</span>
<span class="co">#&gt; Residuals    9  545.8   60.64</span></code></pre></div>
<hr>
<p>Why is the effect of pesticide no longer significant?</p>
<hr>
</div>
<div id="treating-block-effects-as-random-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#treating-block-effects-as-random-effects" class="anchor"></a>Treating block effects as random effects</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aov3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">caterpillar</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">Error</a></span><span class="op">(</span><span class="va">Region</span><span class="op">)</span>, <span class="va">mothData</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">aov3</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: Region</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; Residuals  3  430.9   143.6               </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: Within</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)  </span>
<span class="co">#&gt; Treatment  2  223.2  111.58    5.83 0.0392 *</span>
<span class="co">#&gt; Residuals  6  114.8   19.14                 </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>The values of the ANOVA table are the same as before, and there is no reason to use random effects here if interest only lies in testing the null hypothesis concerning pesticides.</p>
<p>Later, we will see cases where it is important to use random and fixed effects.</p>
</div>
</div>
<div id="exercise" class="section level1">
<h1 class="hasAnchor">
<a href="#exercise" class="anchor"></a>Exercise</h1>
<p>Some time ago, plantations of <em>Pinus caribaea</em> were established at four locations on Puerto Rico. As part of a spacing study, four spacings were used at each location to determine the effect of four specific spacing intervals on tree height. Twenty years after the plantations were established, measurements were made in the study plots as follows:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Location</th>
<th align="center">Spacing (ft)</th>
<th align="left">Height (ft)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Caracoles</td>
<td align="center">5</td>
<td align="left">72</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">7</td>
<td align="left">80</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center">10</td>
<td align="left">85</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">14</td>
<td align="left">91</td>
</tr>
<tr class="odd">
<td align="left">Utuado</td>
<td align="center">5</td>
<td align="left">75</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">7</td>
<td align="left">90</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center">10</td>
<td align="left">94</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">14</td>
<td align="left">112</td>
</tr>
<tr class="odd">
<td align="left">Guzman</td>
<td align="center">5</td>
<td align="left">88</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">7</td>
<td align="left">95</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center">10</td>
<td align="left">94</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">14</td>
<td align="left">91</td>
</tr>
<tr class="odd">
<td align="left">Lares</td>
<td align="center">5</td>
<td align="left">79</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">7</td>
<td align="left">94</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center">10</td>
<td align="left">104</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">14</td>
<td align="left">106</td>
</tr>
</tbody>
</table>
<p>You can access these data using:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"pineData"</span><span class="op">)</span></code></pre></div>
<p>Create an <code>R</code> script or R Markdown file to the address the following:</p>
<ol style="list-style-type: decimal">
<li><p>What is the primary null hypothesis of interest? State it, and the associated alternative hypothesis, as comments in the file</p></li>
<li><p>Test for effects of location and spacing on plant height using the <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> function. NOTE: spacing must be treated as a factor, not as a numeric vector</p></li>
<li><p>Perform a Tukey test to determine which spacings differ</p></li>
</ol>
<p>Note well! Please complete this exercise, because doing so will help you on subsequent assignments and exams. You do not need to turn it in!</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Under the hood, <code>R</code> actually treats factors as integers - 1, 2, 3… - with character labels for each level<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
