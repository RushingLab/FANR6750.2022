<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 8: Nested ANOVA • FANR6750</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 8: Nested ANOVA">
<meta property="og:description" content="FANR6750">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FANR6750</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2021.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/01_basic_stats/01_basic_stats.html">Lecture 1: Basic concepts in statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/02_t-tests/02_t-tests.html">Lecture 2: t-tests</a>
    </li>
    <li>
      <a href="../articles/lectures/03_anova/03_anova.html">Lecture 3: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/04_mult_comparisons/04_mult_comparisons.html">Lecture 4: Multiple comparisons</a>
    </li>
    <li>
      <a href="../articles/lectures/05_contrasts/05_contrasts.html">Lecture 5: Contrasts</a>
    </li>
    <li>
      <a href="../articles/lectures/06_power-analysis/06_power-analysis.html">Lecture 6: Power analysis</a>
    </li>
    <li>
      <a href="../articles/lectures/07_estimation/07_estimation.html">Lecture 7: Estimation</a>
    </li>
    <li>
      <a href="../articles/lectures/08_assumptions/08_assumptions.html">Lecture 8: ANOVA assumptions</a>
    </li>
    <li>
      <a href="../articles/lectures/09_nonparametrics/09_nonparametrics.html">Lecture 9: Non-parametric statistics</a>
    </li>
    <li>
      <a href="../articles/lectures/10_blocking/10_blocking.html">Lecture 10: Blocking</a>
    </li>
    <li>
      <a href="../articles/lectures/11_raneff/11_raneff.html">Lecture 11: Random effects</a>
    </li>
    <li>
      <a href="../articles/lectures/12_factorial/12_factorial.html">Lecture 12: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lectures/13_nesting/13_nesting.html">Lecture 13: Nested designs</a>
    </li>
    <li>
      <a href="../articles/lectures/14_splitplot/14_splitplot.html">Lecture 14: Split plot designs</a>
    </li>
    <li>
      <a href="../articles/lectures/15_repeated_measures/15_repeated_measures.html">Lecture 15: Repeated measures</a>
    </li>
    <li>
      <a href="../articles/lectures/16_ANCOVA/16_ANCOVA.html">Lecture 16: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lectures/17_lm/17_lm.html">Lecture 17: Linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/18_glm/18_glm.html">Lecture 18: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/lectures/19_model_selection/19_model_selection.html">Lecture 19: Model selection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab01_Intro_to_R.html">Lab 1: Introduction to R</a>
    </li>
    <li>
      <a href="../articles/lab02_t-tests.html">Lab 2: t-tests</a>
    </li>
    <li>
      <a href="../articles/lab03_ANOVA.html">Lab 3: ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab04_contrasts.html">Lab 4: Contrasts, estimation, and power analysis</a>
    </li>
    <li>
      <a href="../articles/lab05_assump_nonpar.html">Lab 5: Assumptions of ANOVA, tranformations, and non-parametric tests</a>
    </li>
    <li>
      <a href="../articles/lab06_blocking.html">Lab 6: Randomized Complete Block Design</a>
    </li>
    <li>
      <a href="../articles/lab07_factorial.html">Lab 7: Factorial designs</a>
    </li>
    <li>
      <a href="../articles/lab08_nested.html">Lab 8: Nested ANOVA</a>
    </li>
    <li>
      <a href="../articles/lab09_splitplot.html">Lab 9: Split plot designs</a>
    </li>
    <li>
      <a href="../articles/lab10_repeated_measures.html">Lab 10: Repeated measures</a>
    </li>
    <li>
      <a href="../articles/lab11_ANCOVA.html">Lab 11: ANCOVA</a>
    </li>
    <li>
      <a href="../articles/lab12_lm.html">Lab 12: Linear models</a>
    </li>
    <li>
      <a href="../articles/lab13_glm.html">Lab 13: Generalized linear models</a>
    </li>
    <li>
      <a href="../articles/lab14_model_selection.html">Lab 14: Model selection and multi-model inference</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework.html">Assignment instructions</a>
    </li>
    <li>
      <a href="../articles/projects_and_directories.html">Projects and directories</a>
    </li>
    <li>
      <a href="../articles/RMarkdown.html">R Markdown reference</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lab08_nested_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 8: Nested ANOVA</h1>
            <h3 class="subtitle">FANR 6750: Experimental Methods in Forestry and Natural Resources Research</h3>
                        <h4 class="author">Fall 2021</h4>
            
      
      
      <div class="hidden name"><code>lab08_nested.Rmd</code></div>

    </div>

    
    
<div id="scenario" class="section level1">
<h1 class="hasAnchor">
<a href="#scenario" class="anchor"></a>Scenario</h1>
<p>Remember from lecture that nested designs are useful in situations where we subsample within each experimental unit and we’re interested in treatment effects at the experimental (whole) unit level, not the subunit level. For example:</p>
<ul>
<li><p>We count larvae at multiple subplots within a plot</p></li>
<li><p>We weigh multiple chicks in a brood</p></li>
</ul>
<div id="the-additive-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-additive-model" class="anchor"></a>The additive model</h2>
<p><span class="math display">\[\Large y_{ijk} = \mu + \alpha_i + \beta_{ij} + \epsilon_{ijk}\]</span></p>
<p>Because we want our inferences to apply to all experimental units, not just the ones in our sample, <span class="math inline">\(\beta_{ij}\)</span> is random:</p>
<p><span class="math display">\[\Large \beta_{ij} \sim normal(0, \sigma^2_B)\]</span></p>
<p>And as always,</p>
<p><span class="math display">\[\Large \epsilon_{ijk} \sim normal(0, \sigma^2)\]</span></p>
</div>
<div id="hypotheses" class="section level2">
<h2 class="hasAnchor">
<a href="#hypotheses" class="anchor"></a>Hypotheses</h2>
<p>Treatment effects:</p>
<p><span class="math display">\[\Large H_0 : \alpha_1 = · · · = \alpha_a = 0\]</span> <span class="math display">\[\Large H_a : at\; least\; one\; inequality\]</span> Random variation among experimental units:</p>
<p><span class="math display">\[\Large H_0 : \sigma^2_B = 0\]</span></p>
<p><span class="math display">\[\Large H_a : \sigma^2_B &gt; 0\]</span></p>
<p>Recall that a nested ANOVA is primarily used when the variation among experimental units is of interest. If it is not, we can simplify to a one-way ANOVA.</p>
</div>
<div id="example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h2>
<p>For this lab, we’ll use another data set on the response of gypsy moth larvae to pesticide treatments:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"mothData2"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mothData2</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    36 obs. of  3 variables:</span>
<span class="co">#&gt;  $ larvae   : num  16 16 15.8 14.2 13.9 14.2 13.5 13.4 14 13.1 ...</span>
<span class="co">#&gt;  $ Treatment: chr  "Bt" "Bt" "Bt" "Bt" ...</span>
<span class="co">#&gt;  $ Plot     : int  1 1 1 1 2 2 2 2 3 3 ...</span></code></pre></div>
<p>As before, we’ll need to convert <code>Plot</code> and <code>Treatment</code> to be factors:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mothData2</span><span class="op">$</span><span class="va">Treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mothData2</span><span class="op">$</span><span class="va">Treatment</span>, 
                              levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Bt"</span>, <span class="st">"Dimilin"</span><span class="op">)</span><span class="op">)</span>
<span class="va">mothData2</span><span class="op">$</span><span class="va">Plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mothData2</span><span class="op">$</span><span class="va">Plot</span><span class="op">)</span></code></pre></div>
<p>Note that we explicitly define the levels for <code>Treatment</code> so that control will be treated as the baseline level and plotted first. We don’t need to do that with <code>Plot</code> since the default numeric order is fine.</p>
<p>To see the level of replication within each treatment and plot, let’s cross-tabulate the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">mothData2</span><span class="op">$</span><span class="va">Treatment</span>, <span class="va">mothData2</span><span class="op">$</span><span class="va">Plot</span><span class="op">)</span>
<span class="co">#&gt;          </span>
<span class="co">#&gt;           1 2 3 4 5 6 7 8 9</span>
<span class="co">#&gt;   Control 0 0 0 4 4 4 0 0 0</span>
<span class="co">#&gt;   Bt      4 4 4 0 0 0 0 0 0</span>
<span class="co">#&gt;   Dimilin 0 0 0 0 0 0 4 4 4</span></code></pre></div>
<hr>
<p>Notice how plots are labeled! Not according to <span class="math inline">\(j \in {1, 2, 3}\)</span>, even though there are three plots within each treatment (and four replicates within each plot). Rather, each plot is labeled independently, 1–9.</p>
<p>Why is this important?</p>
<hr>
</div>
<div id="analysis-using-aov" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-using-aov" class="anchor"></a>Analysis using <code>aov()</code>
</h2>
<p>Based on the models we’ve fit previously this semester, we might instinctively analyze these data using the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aov.wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Plot</span>, data <span class="op">=</span> <span class="va">mothData2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">aov.wrong</span><span class="op">)</span>
<span class="co">#&gt;             Df Sum Sq Mean Sq F value Pr(&gt;F)    </span>
<span class="co">#&gt; Treatment    2  215.4   107.7  208.89 &lt;2e-16 ***</span>
<span class="co">#&gt; Plot         6   11.2     1.9    3.61 0.0093 ** </span>
<span class="co">#&gt; Residuals   27   13.9     0.5                   </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
<p>But if we do so, the <strong>denominator degrees of freedom are incorrect</strong>. Instead, we should use:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aov.correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">Error</a></span><span class="op">(</span><span class="va">Plot</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mothData2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">aov.correct</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: Plot</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span>
<span class="co">#&gt; Treatment  2  215.4   107.7    57.9 0.00012 ***</span>
<span class="co">#&gt; Residuals  6   11.2     1.9                    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Error: Within</span>
<span class="co">#&gt;           Df Sum Sq Mean Sq F value Pr(&gt;F)</span>
<span class="co">#&gt; Residuals 27   13.9   0.516</span></code></pre></div>
<p>Can you spot the difference? What calculations changed between these two analyses?</p>
<p>What happens if we analyze plot-level means? The <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code> function is similar to <code><a href="https://rdrr.io/r/base/tapply.html">tapply()</a></code> but it works on entire data frames. Here we get averages for each whole plot:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span> <span class="op">+</span> <span class="va">Plot</span>, 
                      data <span class="op">=</span> <span class="va">mothData2</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
<span class="va">plotData</span>
<span class="co">#&gt;   Treatment Plot larvae</span>
<span class="co">#&gt; 1        Bt    1  15.50</span>
<span class="co">#&gt; 2        Bt    2  13.75</span>
<span class="co">#&gt; 3        Bt    3  14.00</span>
<span class="co">#&gt; 4   Control    4  18.25</span>
<span class="co">#&gt; 5   Control    5  18.75</span>
<span class="co">#&gt; 6   Control    6  19.25</span>
<span class="co">#&gt; 7   Dimilin    7  12.50</span>
<span class="co">#&gt; 8   Dimilin    8  13.50</span>
<span class="co">#&gt; 9   Dimilin    9  13.00</span></code></pre></div>
<p>When we use <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> to analyze the aggregated data, we get the same <em>F</em> and <em>p</em> as before:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aov.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span>, data <span class="op">=</span> <span class="va">plotData</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">aov.plot</span><span class="op">)</span>
<span class="co">#&gt;             Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span>
<span class="co">#&gt; Treatment    2   53.8   26.92    57.9 0.00012 ***</span>
<span class="co">#&gt; Residuals    6    2.8    0.47                    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></code></pre></div>
</div>
<div id="issues-with-analyzing-nested-data" class="section level2">
<h2 class="hasAnchor">
<a href="#issues-with-analyzing-nested-data" class="anchor"></a>Issues with analyzing nested data</h2>
<p>When using using <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> with Error term:</p>
<ul>
<li><p>You can’t use <code><a href="https://rdrr.io/r/stats/TukeyHSD.html">TukeyHSD()</a></code></p></li>
<li><p>You don’t get a direct estimate of <span class="math inline">\(\sigma^2_B\)</span></p></li>
<li><p>Doesn’t handle unbalanced designs well</p></li>
<li><p>But, you can use <code><a href="https://rdrr.io/r/stats/model.tables.html">model.tables()</a></code> and <code><a href="https://rdrr.io/r/stats/se.contrast.html">se.contrast()</a></code></p></li>
</ul>
<p>An alternative is to use <code><a href="https://rdrr.io/pkg/nlme/man/lme.html">lme()</a></code> function in <code>nlme</code> package</p>
<ul>
<li><p>Possible to get direct estimates of <span class="math inline">\(\sigma^2_B\)</span> and other variance parameters</p></li>
<li><p>Handles very complex models and unbalanced designs</p></li>
<li><p>Possible to do multiple comparisons and contrasts using the <code><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht()</a></code> function in the <code>multcomp</code> package</p></li>
</ul>
<p>But…</p>
<ul>
<li><p>Only works if there random effects</p></li>
<li><p>ANOVA tables aren’t as complete as <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code></p></li>
</ul>
</div>
<div id="using-the-lme-function" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-lme-function" class="anchor"></a>Using the <code>lme()</code> function</h2>
<p>To see how the <code><a href="https://rdrr.io/pkg/nlme/man/lme.html">lme()</a></code> function works let’s fit the moth data model using this approach:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://multcomp.R-forge.R-project.org">multcomp</a></span><span class="op">)</span>

<span class="va">lme1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html">lme</a></span><span class="op">(</span><span class="va">larvae</span> <span class="op">~</span> <span class="va">Treatment</span>, random <span class="op">=</span> <span class="op">~</span><span class="fl">1</span><span class="op">|</span><span class="va">Plot</span>, data <span class="op">=</span> <span class="va">mothData2</span><span class="op">)</span></code></pre></div>
<p>The syntax for random effects can be a little confusing at first but see <code><a href="https://rdrr.io/pkg/nlme/man/lme.html">?lme</a></code> for additional information.</p>
<p>Now we can view the ANOVA table from the model using:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">lme1</span>, Terms <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span>
<span class="co">#&gt; F-test for: Treatment </span>
<span class="co">#&gt;   numDF denDF F-value p-value</span>
<span class="co">#&gt; 1     2     6   57.87   1e-04</span></code></pre></div>
<p>And we can view the variance parameter estimates:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">lme1</span><span class="op">)</span>
<span class="co">#&gt; Plot = pdLogChol(1) </span>
<span class="co">#&gt;             Variance StdDev</span>
<span class="co">#&gt; (Intercept) 0.3364   0.580 </span>
<span class="co">#&gt; Residual    0.5156   0.718</span></code></pre></div>
<p>The first row shows the estimates of <span class="math inline">\(\sigma^2_B\)</span> and <span class="math inline">\(\sigma_B\)</span>. The second row shows the estimates of <span class="math inline">\(\sigma^2\)</span> and <span class="math inline">\(\sigma\)</span>.</p>
<hr>
<p>What can we say about the amount of random variation within whole units relative to among whole units (after accounting for treatment effects)?</p>
<hr>
<p>Next, we can extract the plot-level random effects. These are the <span class="math inline">\(\beta_{ij}\)</span>’s:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">lme1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;   (Intercept)</span>
<span class="co">#&gt; 1        0.78</span>
<span class="co">#&gt; 2       -0.48</span>
<span class="co">#&gt; 3       -0.30</span>
<span class="co">#&gt; 4       -0.36</span>
<span class="co">#&gt; 5        0.00</span>
<span class="co">#&gt; 6        0.36</span>
<span class="co">#&gt; 7       -0.36</span>
<span class="co">#&gt; 8        0.36</span>
<span class="co">#&gt; 9        0.00</span></code></pre></div>
<p>And finally, multiple comparisons:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tuk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">glht</a></span><span class="op">(</span><span class="va">lme1</span>, linfct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/multcomp/man/glht.html">mcp</a></span><span class="op">(</span>Treatment<span class="op">=</span><span class="st">"Tukey"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">tuk</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multiple Comparisons of Means: Tukey Contrasts</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fit: lme.formula(fixed = larvae ~ Treatment, data = mothData2, random = ~1 | </span>
<span class="co">#&gt;     Plot)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Linear Hypotheses:</span>
<span class="co">#&gt;                        Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; Bt - Control == 0        -4.333      0.557   -7.78   &lt;0.001 ***</span>
<span class="co">#&gt; Dimilin - Control == 0   -5.750      0.557  -10.32   &lt;0.001 ***</span>
<span class="co">#&gt; Dimilin - Bt == 0        -1.417      0.557   -2.54     0.03 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; (Adjusted p values reported -- single-step method)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">tuk</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Simultaneous Confidence Intervals</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Multiple Comparisons of Means: Tukey Contrasts</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Fit: lme.formula(fixed = larvae ~ Treatment, data = mothData2, random = ~1 | </span>
<span class="co">#&gt;     Plot)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Quantile = 2.343</span>
<span class="co">#&gt; 95% family-wise confidence level</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Linear Hypotheses:</span>
<span class="co">#&gt;                        Estimate lwr    upr   </span>
<span class="co">#&gt; Bt - Control == 0      -4.333   -5.638 -3.028</span>
<span class="co">#&gt; Dimilin - Control == 0 -5.750   -7.055 -4.445</span>
<span class="co">#&gt; Dimilin - Bt == 0      -1.417   -2.722 -0.112</span></code></pre></div>
</div>
</div>
<div id="assignment" class="section level1">
<h1 class="hasAnchor">
<a href="#assignment" class="anchor"></a>Assignment</h1>
<p>To determine if salinity affects adult fish reproductive performance, a researcher places one pregnant female in a tank with one of three salinity levels: low, medium, and high, or a control tank. A week after birth, two offspring (fry) are measured.</p>
<p>The data can be accessed using:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FANR6750</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fishData"</span><span class="op">)</span></code></pre></div>
<p>Run a nested ANOVA using <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> and <code><a href="https://rdrr.io/pkg/nlme/man/lme.html">lme()</a></code> on the fish dataset. Answer the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>What are the null and alternative hypotheses?</p></li>
<li><p>Does salinity affect fry growth?</p></li>
<li><p>If so, which salinity levels differ?</p></li>
<li><p>Is there more random variation among or within experimental units?</p></li>
</ol>
<p>Put your answers in an R Markdown report. Your report should include:</p>
<ol style="list-style-type: decimal">
<li><p>A well-formatted ANOVA table (with caption); and</p></li>
<li><p>A publication-quality plot of the estimated effect of salinity on fry growth, including 95% confidence intervals. The figure should also have a descriptive caption and any aesthetics (color, line type, etc.) should be clearly defined.</p></li>
</ol>
<p>You may format the report however you like but it should be well-organized, with relevant headers, plain text, and the elements described above.</p>
<p>As always:</p>
<ul>
<li><p>Be sure the output type is set to: <code>output: html_document</code></p></li>
<li><p>Title the document: <code>title: "Lab 8 assignment"</code></p></li>
<li><p>Be sure to include your first and last name in the <code>author</code> section</p></li>
<li><p>Be sure to set <code>echo = TRUE</code> in all <code>R</code> chunks so we can see both your code and the output</p></li>
<li><p>Please upload both the <code>html</code> and <code>.Rmd</code> files when you submit your assignment</p></li>
<li><p>See the R Markdown reference sheet for help with creating <code>R</code> chunks, equations, tables, etc.</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
